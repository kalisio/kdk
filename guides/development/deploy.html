<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Deploy your app | KDK</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="https://s3.eu-central-1.amazonaws.com/kalisioscope/kdk/kdk-icon-64x64.png">
    <link rel="manifest" href="/kdk/manifest.json">
    <meta name="description" content="The Kalisio Development Kit">
    
    <link rel="preload" href="/kdk/assets/css/0.styles.d338d316.css" as="style"><link rel="preload" href="/kdk/assets/js/app.a26fd56b.js" as="script"><link rel="preload" href="/kdk/assets/js/3.e14f8819.js" as="script"><link rel="preload" href="/kdk/assets/js/4.f9ee2bfb.js" as="script"><link rel="preload" href="/kdk/assets/js/9.cdfb28c3.js" as="script"><link rel="prefetch" href="/kdk/assets/js/10.4b367e32.js"><link rel="prefetch" href="/kdk/assets/js/11.efd8aceb.js"><link rel="prefetch" href="/kdk/assets/js/12.3890906e.js"><link rel="prefetch" href="/kdk/assets/js/13.71728aab.js"><link rel="prefetch" href="/kdk/assets/js/14.8f8ff4a8.js"><link rel="prefetch" href="/kdk/assets/js/15.5041e92b.js"><link rel="prefetch" href="/kdk/assets/js/16.3294fe10.js"><link rel="prefetch" href="/kdk/assets/js/17.8f96e38a.js"><link rel="prefetch" href="/kdk/assets/js/18.0878dbfa.js"><link rel="prefetch" href="/kdk/assets/js/19.1a6ccc4b.js"><link rel="prefetch" href="/kdk/assets/js/2.deee2b8b.js"><link rel="prefetch" href="/kdk/assets/js/20.813b16ff.js"><link rel="prefetch" href="/kdk/assets/js/21.22a499ee.js"><link rel="prefetch" href="/kdk/assets/js/22.48a5d9c1.js"><link rel="prefetch" href="/kdk/assets/js/23.4707dbff.js"><link rel="prefetch" href="/kdk/assets/js/24.cb159dff.js"><link rel="prefetch" href="/kdk/assets/js/25.18688935.js"><link rel="prefetch" href="/kdk/assets/js/26.c1de103c.js"><link rel="prefetch" href="/kdk/assets/js/27.f5f9d776.js"><link rel="prefetch" href="/kdk/assets/js/28.eefe9272.js"><link rel="prefetch" href="/kdk/assets/js/29.f11e7882.js"><link rel="prefetch" href="/kdk/assets/js/30.efa925c4.js"><link rel="prefetch" href="/kdk/assets/js/31.e6033c0a.js"><link rel="prefetch" href="/kdk/assets/js/32.920a3c95.js"><link rel="prefetch" href="/kdk/assets/js/33.a64efa74.js"><link rel="prefetch" href="/kdk/assets/js/34.e5301dab.js"><link rel="prefetch" href="/kdk/assets/js/35.58f8be71.js"><link rel="prefetch" href="/kdk/assets/js/36.95a163bd.js"><link rel="prefetch" href="/kdk/assets/js/37.d2e8e7a1.js"><link rel="prefetch" href="/kdk/assets/js/38.b351dfac.js"><link rel="prefetch" href="/kdk/assets/js/39.79d9ea8a.js"><link rel="prefetch" href="/kdk/assets/js/40.da9fd38e.js"><link rel="prefetch" href="/kdk/assets/js/41.ae726b12.js"><link rel="prefetch" href="/kdk/assets/js/42.5dbd2b72.js"><link rel="prefetch" href="/kdk/assets/js/43.07172685.js"><link rel="prefetch" href="/kdk/assets/js/44.4fca58e6.js"><link rel="prefetch" href="/kdk/assets/js/45.568e2210.js"><link rel="prefetch" href="/kdk/assets/js/46.d5c83e51.js"><link rel="prefetch" href="/kdk/assets/js/47.65a69d15.js"><link rel="prefetch" href="/kdk/assets/js/48.8049299d.js"><link rel="prefetch" href="/kdk/assets/js/49.feaf7c96.js"><link rel="prefetch" href="/kdk/assets/js/5.990bbb57.js"><link rel="prefetch" href="/kdk/assets/js/50.8494501e.js"><link rel="prefetch" href="/kdk/assets/js/51.4e5a7213.js"><link rel="prefetch" href="/kdk/assets/js/52.02579dd3.js"><link rel="prefetch" href="/kdk/assets/js/6.999e2de5.js"><link rel="prefetch" href="/kdk/assets/js/7.0ed85780.js"><link rel="prefetch" href="/kdk/assets/js/8.63952efe.js">
    <link rel="stylesheet" href="/kdk/assets/css/0.styles.d338d316.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/kdk/" class="home-link router-link-active"><!----> <span class="site-name">KDK</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/kdk/about/" class="nav-link">
  About
</a></div><div class="nav-item"><a href="/kdk/guides/" class="nav-link router-link-active">
  Guides
</a></div><div class="nav-item"><a href="/kdk/architecture/" class="nav-link">
  Architecture
</a></div><div class="nav-item"><a href="/kdk/api/" class="nav-link">
  API
</a></div><div class="nav-item"><a href="/kdk/tips.html" class="nav-link">
  Tips
</a></div><div class="nav-item"><a href="/kdk/tools/" class="nav-link">
  Tools
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/kdk/about/" class="nav-link">
  About
</a></div><div class="nav-item"><a href="/kdk/guides/" class="nav-link router-link-active">
  Guides
</a></div><div class="nav-item"><a href="/kdk/architecture/" class="nav-link">
  Architecture
</a></div><div class="nav-item"><a href="/kdk/api/" class="nav-link">
  API
</a></div><div class="nav-item"><a href="/kdk/tips.html" class="nav-link">
  Tips
</a></div><div class="nav-item"><a href="/kdk/tools/" class="nav-link">
  Tools
</a></div> <!----></nav> <p align="center"><a href="https://kalisio.com"><img src="https://s3.eu-central-1.amazonaws.com/kalisioscope/kalisio/kalisio-logo-black-256x84.png"></a> <br> <!----></p> <ul class="sidebar-links"><li><a href="/kdk/guides/" aria-current="page" class="sidebar-link">Guides</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>The Basics</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Development</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/kdk/guides/development/setup.html" class="sidebar-link">Setup your environment</a></li><li><a href="/kdk/guides/development/develop.html" class="sidebar-link">Develop with KDK</a></li><li><a href="/kdk/guides/development/configure.html" class="sidebar-link">Configure your app</a></li><li><a href="/kdk/guides/development/deploy.html" aria-current="page" class="active sidebar-link">Deploy your app</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kdk/guides/development/deploy.html#deployment-pipeline" class="sidebar-link">Deployment pipeline</a></li><li class="sidebar-sub-header"><a href="/kdk/guides/development/deploy.html#deployment-flavors" class="sidebar-link">Deployment flavors</a></li><li class="sidebar-sub-header"><a href="/kdk/guides/development/deploy.html#deployment-workspace" class="sidebar-link">Deployment workspace</a></li><li class="sidebar-sub-header"><a href="/kdk/guides/development/deploy.html#web-application-deployment" class="sidebar-link">Web application deployment</a></li><li class="sidebar-sub-header"><a href="/kdk/guides/development/deploy.html#mobile-applications-deployment" class="sidebar-link">Mobile applications deployment</a></li></ul></li><li><a href="/kdk/guides/development/publish.html" class="sidebar-link">Publish your app</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="deploy-your-app"><a href="#deploy-your-app" class="header-anchor">#</a> Deploy your app</h1> <h2 id="deployment-pipeline"><a href="#deployment-pipeline" class="header-anchor">#</a> Deployment pipeline</h2> <p>The main purpose of the continuous integration and deployment (CI/CD) pipeline is to create/build application artifacts (Docker images for the web application and mobile application bundles) and deploy it in production-like environments in order to test/run it. We rely on <a href="https://travis-ci.org" target="_blank" rel="noopener noreferrer">Travis CI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for continuous integration and delivery, as such you need to create the CI/CD pipeline in Travis CI by syncing your GitHub repository.</p> <p>You can read this <a href="https://medium.com/better-programming/why-we-stopped-using-so-called-best-practices-in-our-ci-cd-process-2ff09811f633" target="_blank" rel="noopener noreferrer">article<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> on Medium to get an overview of our global CI/CD pipeline, which is illustrated in the following schema:</p> <p><img src="/kdk/assets/img/cd-pipeline-global.bf86d245.svg" alt="Global deployment pipeline"></p> <p>The different operations performed by each stages are the following:</p> <ul><li><strong>APP</strong>: executes the <em>travis.app.sh</em> script to
<ul><li>creates the Docker images for the application and testing</li> <li>run backend and frontend tests on the target infrastructure</li> <li>deploy the web application on the target infrastructure</li></ul></li> <li><strong>ANDROID</strong>: executes the <em>travis.android.sh</em> script to
<ul><li>build the Android APK</li> <li>deploy it to Google Play</li></ul></li> <li><strong>IOS</strong>: executes the <em>travis.ios.sh</em> script to
<ul><li>build the iOS IPA</li> <li>deploy it to App Store Connect</li></ul></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>You can skip any of this stage by adding <code>[skip stage]</code> to your commit message, e.g. <code>[skip android]</code> to skip the Android build</p></div> <p>In addition, the <em>travis.env.sh</em> script automatically generates a temporary environment file, based on the secret variables defined in the Travis repository settings or coming from a dedicated private repository (see details hereafter), which is used to <a href="/kdk/guides/development/configure.html">configure the application</a>. The following schema summarizes the different scripts used by the CI/CD:</p> <p><img src="/kdk/assets/img/cd-pipeline-travis.5e40ee62.svg" alt="Travis scripts"></p> <h2 id="deployment-flavors"><a href="#deployment-flavors" class="header-anchor">#</a> Deployment flavors</h2> <p>CI/CD comes al well in three different flavors, as defined by the value of the <code>FLAVOR</code>/<code>NODE_APP_INSTANCE</code> environment variables:</p> <ul><li><strong>dev</strong>: in order to deploy current development/alpha version, linked to the <code>master</code> branch of your code</li> <li><strong>test</strong>: in order to deploy current staging/beta version, usually linked to the <code>test</code> branch of your code, identified by matching the following regular expression pattern <code>^test-*|-test$</code></li> <li><strong>prod</strong>: in order to deploy current production version, usually linked to specific <code>tags</code> on the <code>test</code> branch of your code by matching the following regular expression pattern <code>^prod-v[0-9]+\.[0-9]+\.[0-9]+</code></li></ul> <p>The output Docker image artifacts use the prerelease SemVer notation to identify which flavor has been used to produce it —  <code>1.0.0-dev</code> for alpha version, <code>1.0.0-test</code> for beta version or <code>1.0.0-prod</code> for production.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>In the CI/CD process the <code>FLAVOR</code>/<code>NODE_APP_INSTANCE</code> environment variable is automatically set based on the branch/tag you are pushing. During local development these variables are usually not defined.</p></div> <p>Starting from the following base application setup:</p> <ul><li>a root domain, defined by the value of the <code>DOMAIN</code> environment variable like <code>kalisio.xyz</code></li> <li>a version number, defined by the value of the <code>VERSION</code> environment variable like <code>1.3.0</code> and automatically extracted from your <em>package.json</em> file</li> <li>a name, defined in the <code>APP</code> environment variable like <code>kapp</code></li></ul> <p>Each flavor is then attached to a different target infrastructure, subdomain and version tag:</p> <ul><li><strong>dev</strong>: <code>SUBDOMAIN=dev.$DOMAIN</code>, <code>VERSION_TAG=$VERSION-dev</code></li> <li><strong>test</strong>: <code>SUBDOMAIN=test.$DOMAIN</code>, <code>VERSION_TAG=$VERSION-test</code></li> <li><strong>prod</strong>: <code>SUBDOMAIN=$DOMAIN</code>, <code>VERSION_TAG=$VERSION-prod</code></li></ul> <p>The subdomain is usually used to build a fully-qualified domain name for the application based on its name, i.e. <code>$APP.$SUBDOMAIN</code>. The version tag defines the name of the created Docker images as <code>$APP:$VERSION_TAG</code>.</p> <h2 id="deployment-workspace"><a href="#deployment-workspace" class="header-anchor">#</a> Deployment workspace</h2> <p>Each build stage of the CI/CD pipeline first setup the &quot;workspace&quot; required to correctly build the application, i.e. environment variables, application and module source code, configuration files, etc. The following schema summarizes the different steps performed to setup the workspace in the <em>travis.env.sh</em> script:</p> <p><img src="/kdk/assets/img/cd-pipeline-env.e2075fb1.svg" alt="Travis scripts"></p> <p>In order to simplify and unify as much as possible secrets management we use a private GitHub repository as a secret store for:</p> <ul><li>environment variables through env files
<ul><li><strong>.env</strong> for application configuration</li> <li><strong>.travis.env</strong> for CI/CD configuration</li></ul></li> <li>configuration files required either by the application or the CI/CD (e.g. mobile application certificates, ssh key to connect to hosting infrastructures, etc.)</li></ul> <p>Each workspace includes a <strong>common</strong> folder to store shared secrets between all flavor, then a folder dedicated to secrets specific to each flavor as depicted in the following diagram:</p> <p><img src="/kdk/assets/img/kdk-workspace.d228efd0.png" alt="KDK workspace"></p> <h2 id="web-application-deployment"><a href="#web-application-deployment" class="header-anchor">#</a> Web application deployment</h2> <p>The following schema summarizes the different steps performed to deploy the web application:</p> <p><img src="/kdk/assets/img/cd-pipeline-app.f5ae4922.svg" alt="Travis scripts"></p> <h2 id="mobile-applications-deployment"><a href="#mobile-applications-deployment" class="header-anchor">#</a> Mobile applications deployment</h2> <p>The following schema summarizes the different steps performed to deploy the Android application:</p> <p><img src="/kdk/assets/img/cd-pipeline-android.aac6a2e0.svg" alt="Travis scripts"></p> <p>The following schema summarizes the different steps performed to deploy the IOS application:</p> <p><img src="/kdk/assets/img/cd-pipeline-ios.b4f66a54.svg" alt="Travis scripts"></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/kdk/guides/development/configure.html" class="prev">
        Configure your app
      </a></span> <span class="next"><a href="/kdk/guides/development/publish.html">
        Publish your app
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/kdk/assets/js/app.a26fd56b.js" defer></script><script src="/kdk/assets/js/3.e14f8819.js" defer></script><script src="/kdk/assets/js/4.f9ee2bfb.js" defer></script><script src="/kdk/assets/js/9.cdfb28c3.js" defer></script>
  </body>
</html>
