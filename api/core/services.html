<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Services | KDK</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="https://s3.eu-central-1.amazonaws.com/kalisioscope/kdk/kdk-icon-64x64.png">
    <link rel="manifest" href="/kdk/manifest.json">
    <meta name="description" content="The Kalisio Development Kit">
    
    <link rel="preload" href="/kdk/assets/css/0.styles.d338d316.css" as="style"><link rel="preload" href="/kdk/assets/js/app.96fe67fb.js" as="script"><link rel="preload" href="/kdk/assets/js/3.e14f8819.js" as="script"><link rel="preload" href="/kdk/assets/js/33.28443a0b.js" as="script"><link rel="preload" href="/kdk/assets/js/9.cdfb28c3.js" as="script"><link rel="prefetch" href="/kdk/assets/js/10.4b367e32.js"><link rel="prefetch" href="/kdk/assets/js/11.efd8aceb.js"><link rel="prefetch" href="/kdk/assets/js/12.3890906e.js"><link rel="prefetch" href="/kdk/assets/js/13.71728aab.js"><link rel="prefetch" href="/kdk/assets/js/14.8506331e.js"><link rel="prefetch" href="/kdk/assets/js/15.2ea31af5.js"><link rel="prefetch" href="/kdk/assets/js/16.39ef36aa.js"><link rel="prefetch" href="/kdk/assets/js/17.737b7a32.js"><link rel="prefetch" href="/kdk/assets/js/18.0878dbfa.js"><link rel="prefetch" href="/kdk/assets/js/19.1a6ccc4b.js"><link rel="prefetch" href="/kdk/assets/js/2.deee2b8b.js"><link rel="prefetch" href="/kdk/assets/js/20.813b16ff.js"><link rel="prefetch" href="/kdk/assets/js/21.22a499ee.js"><link rel="prefetch" href="/kdk/assets/js/22.48a5d9c1.js"><link rel="prefetch" href="/kdk/assets/js/23.4707dbff.js"><link rel="prefetch" href="/kdk/assets/js/24.cb159dff.js"><link rel="prefetch" href="/kdk/assets/js/25.827fc808.js"><link rel="prefetch" href="/kdk/assets/js/26.c1de103c.js"><link rel="prefetch" href="/kdk/assets/js/27.f5f9d776.js"><link rel="prefetch" href="/kdk/assets/js/28.eefe9272.js"><link rel="prefetch" href="/kdk/assets/js/29.f11e7882.js"><link rel="prefetch" href="/kdk/assets/js/30.9a632cf7.js"><link rel="prefetch" href="/kdk/assets/js/31.e6033c0a.js"><link rel="prefetch" href="/kdk/assets/js/32.920a3c95.js"><link rel="prefetch" href="/kdk/assets/js/34.e5301dab.js"><link rel="prefetch" href="/kdk/assets/js/35.1635ae4d.js"><link rel="prefetch" href="/kdk/assets/js/36.95a163bd.js"><link rel="prefetch" href="/kdk/assets/js/37.d2e8e7a1.js"><link rel="prefetch" href="/kdk/assets/js/38.943cd4d1.js"><link rel="prefetch" href="/kdk/assets/js/39.79d9ea8a.js"><link rel="prefetch" href="/kdk/assets/js/4.f9ee2bfb.js"><link rel="prefetch" href="/kdk/assets/js/40.da9fd38e.js"><link rel="prefetch" href="/kdk/assets/js/41.ae726b12.js"><link rel="prefetch" href="/kdk/assets/js/42.5dbd2b72.js"><link rel="prefetch" href="/kdk/assets/js/43.07172685.js"><link rel="prefetch" href="/kdk/assets/js/44.4fca58e6.js"><link rel="prefetch" href="/kdk/assets/js/45.568e2210.js"><link rel="prefetch" href="/kdk/assets/js/46.d5c83e51.js"><link rel="prefetch" href="/kdk/assets/js/47.65a69d15.js"><link rel="prefetch" href="/kdk/assets/js/48.8049299d.js"><link rel="prefetch" href="/kdk/assets/js/49.feaf7c96.js"><link rel="prefetch" href="/kdk/assets/js/5.70125bb4.js"><link rel="prefetch" href="/kdk/assets/js/50.8494501e.js"><link rel="prefetch" href="/kdk/assets/js/51.4e5a7213.js"><link rel="prefetch" href="/kdk/assets/js/52.02579dd3.js"><link rel="prefetch" href="/kdk/assets/js/6.79d871bb.js"><link rel="prefetch" href="/kdk/assets/js/7.53dc5e32.js"><link rel="prefetch" href="/kdk/assets/js/8.63952efe.js">
    <link rel="stylesheet" href="/kdk/assets/css/0.styles.d338d316.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/kdk/" class="home-link router-link-active"><!----> <span class="site-name">KDK</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/kdk/about/" class="nav-link">
  About
</a></div><div class="nav-item"><a href="/kdk/guides/" class="nav-link">
  Guides
</a></div><div class="nav-item"><a href="/kdk/architecture/" class="nav-link">
  Architecture
</a></div><div class="nav-item"><a href="/kdk/api/" class="nav-link router-link-active">
  API
</a></div><div class="nav-item"><a href="/kdk/tips.html" class="nav-link">
  Tips
</a></div><div class="nav-item"><a href="/kdk/tools/" class="nav-link">
  Tools
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/kdk/about/" class="nav-link">
  About
</a></div><div class="nav-item"><a href="/kdk/guides/" class="nav-link">
  Guides
</a></div><div class="nav-item"><a href="/kdk/architecture/" class="nav-link">
  Architecture
</a></div><div class="nav-item"><a href="/kdk/api/" class="nav-link router-link-active">
  API
</a></div><div class="nav-item"><a href="/kdk/tips.html" class="nav-link">
  Tips
</a></div><div class="nav-item"><a href="/kdk/tools/" class="nav-link">
  Tools
</a></div> <!----></nav> <p align="center"><a href="https://kalisio.com"><img src="https://s3.eu-central-1.amazonaws.com/kalisioscope/kalisio/kalisio-logo-black-256x84.png"></a> <br> <!----></p> <ul class="sidebar-links"><li><a href="/kdk/api/" aria-current="page" class="sidebar-link">API</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>core</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/kdk/api/core/" aria-current="page" class="sidebar-link">Overview</a></li><li><a href="/kdk/api/core/application.html" class="sidebar-link">Application</a></li><li><a href="/kdk/api/core/services.html" aria-current="page" class="active sidebar-link">Services</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kdk/api/core/services.html#users-service" class="sidebar-link">Users service</a></li><li class="sidebar-sub-header"><a href="/kdk/api/core/services.html#devices-service" class="sidebar-link">Devices service</a></li><li class="sidebar-sub-header"><a href="/kdk/api/core/services.html#mailer-service" class="sidebar-link">Mailer service</a></li><li class="sidebar-sub-header"><a href="/kdk/api/core/services.html#pusher-service" class="sidebar-link">Pusher service</a></li><li class="sidebar-sub-header"><a href="/kdk/api/core/services.html#account-service" class="sidebar-link">Account service</a></li><li class="sidebar-sub-header"><a href="/kdk/api/core/services.html#authorisations-service" class="sidebar-link">Authorisations service</a></li><li class="sidebar-sub-header"><a href="/kdk/api/core/services.html#tags-service" class="sidebar-link">Tags service</a></li><li class="sidebar-sub-header"><a href="/kdk/api/core/services.html#storage-service" class="sidebar-link">Storage service</a></li><li class="sidebar-sub-header"><a href="/kdk/api/core/services.html#databases-service" class="sidebar-link">Databases service</a></li><li class="sidebar-sub-header"><a href="/kdk/api/core/services.html#organisations-service" class="sidebar-link">Organisations service</a></li><li class="sidebar-sub-header"><a href="/kdk/api/core/services.html#members-service" class="sidebar-link">Members service</a></li><li class="sidebar-sub-header"><a href="/kdk/api/core/services.html#groups-service" class="sidebar-link">Groups service</a></li><li class="sidebar-sub-header"><a href="/kdk/api/core/services.html#local-settings-service" class="sidebar-link">Local settings service</a></li></ul></li><li><a href="/kdk/api/core/hooks.html" class="sidebar-link">Hooks</a></li><li><a href="/kdk/api/core/components.html" class="sidebar-link">Components</a></li><li><a href="/kdk/api/core/mixins.html" class="sidebar-link">Mixins</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>map</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="services"><a href="#services" class="header-anchor">#</a> Services</h1> <h2 id="users-service"><a href="#users-service" class="header-anchor">#</a> Users service</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Available as a global service</p></div> <h3 id="data-model"><a href="#data-model" class="header-anchor">#</a> Data model</h3> <p>The data model of a user as used by the API is <a href="/kdk/architecture/data-model-view.html#user-data-model">detailed here</a>.</p> <h3 id="hooks"><a href="#hooks" class="header-anchor">#</a> Hooks</h3> <p>The following <a href="/kdk/api/core/hooks.html">hooks</a> are executed on the <code>users</code> service:</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><h2 id="devices-service"><a href="#devices-service" class="header-anchor">#</a> Devices service</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Available as a global service</p></div> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p><code>update</code> and <code>remove</code> methods are the only ones allowed from the client side
<code>create</code> method is only allowed from the server side</p></div> <p><code>create</code> (respectively <code>remove</code>) creates (respectively removes) the device to/from the notification system (APNS or Firebase).
<code>update</code> updates the device registration ID or create it if not yet created.</p> <h3 id="data-model-2"><a href="#data-model-2" class="header-anchor">#</a> Data model</h3> <p>The data model of a device as used by the API is <a href="/kdk/architecture/data-model-view.html#device-data-model">detailed here</a>.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Devices are store in the <code>devices</code> property of the user they belong to.</p></div> <h3 id="hooks-2"><a href="#hooks-2" class="header-anchor">#</a> Hooks</h3> <p>The following <a href="/kdk/api/core/hooks.html">hooks</a> are executed on the <code>devices</code> service:</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><h2 id="mailer-service"><a href="#mailer-service" class="header-anchor">#</a> Mailer service</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Available as a global service</p></div> <p>This service is powered by <a href="https://github.com/feathersjs-ecosystem/feathers-mailer" target="_blank" rel="noopener noreferrer">feathers-mailer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. It acts as a proxy to send emails through an SMTP server.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Service methods are only allowed from the server side. <code>create</code> is the sole available method used to send an email.</p></div> <div class="custom-block warning"><p class="custom-block-title">DEPRECATION NOTICE</p> <p>The email account can authorise connection by email/password on <a href="https://myaccount.google.com/lesssecureapps" target="_blank" rel="noopener noreferrer">https://myaccount.google.com/lesssecureapps<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Before that the domain admin should allow him to manage this setting (<em>Admin Console &gt; Security &gt; General &gt; Less secure apps settings</em>). To avoid changing it for all users first create a group, add the user to the group and let the group manage less secure apps setting.</p></div> <p>On 15 february 2021 Gmail API requires OAuth2 authentication to send emails. The simplest solution is to create a <a href="https://medium.com/@imre_7961/nodemailer-with-g-suite-oauth2-4c86049f778a" target="_blank" rel="noopener noreferrer">service account<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and to <a href="https://developers.google.com/identity/protocols/oauth2/service-account" target="_blank" rel="noopener noreferrer">delegate the domain-wide authority to the service account<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> with scope <code>https://mail.google.com</code>.</p> <h3 id="hooks-3"><a href="#hooks-3" class="header-anchor">#</a> Hooks</h3> <p>The following <a href="/kdk/api/core/hooks.html">hooks</a> are executed on the <code>databases</code> service:</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><h2 id="pusher-service"><a href="#pusher-service" class="header-anchor">#</a> Pusher service</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Available as a global service</p></div> <p>This service relies on <a href="https://github.com/kalisio/sns-mobile" target="_blank" rel="noopener noreferrer">sns-mobile<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, which has a <a href="http://evanshortiss.com/development/mobile/2014/02/22/sns-push-notifications-using-nodejs.html" target="_blank" rel="noopener noreferrer">nice tutorial<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, to manage the link between <a href="https://aws.amazon.com/sns" target="_blank" rel="noopener noreferrer">AWS SNS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and internal resource objects in order to send push notifications to users.</p> <p>To get an API access/secret key you need to create a new user in IAM with a role giving access to SNS like <code>AmazonSNSFullAccess</code> but in production <a href="http://docs.aws.amazon.com/sns/latest/dg/UsingIAMwithSNS.html" target="_blank" rel="noopener noreferrer">you should control access more precisely<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Since 2017 Google Cloud Messaging (GCM) has become Firebase Cloud Messaging (FCM), to generate an API key follow <a href="https://stackoverflow.com/questions/39417797/amazon-sns-platform-credentials-are-invalid-when-re-entering-a-gcm-api-key-th" target="_blank" rel="noopener noreferrer">this issue<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and enter the server key when creating the SNS application on AWS. Although you use the Firebase console you should also see the created API through the Google Cloud console.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p><code>create</code> and <code>remove</code> methods are the only one allowed from the server side</p></div> <h3 id="data-model-3"><a href="#data-model-3" class="header-anchor">#</a> Data model</h3> <p>This service helps (un)registering devices to/from SNS and create/remove SNS topics. This service also helps associating a <em>resource</em> object (e.g. a group) with a SNS <em>topic</em> to provide push notifications to the users associated with the resource. SNS ARNs are directly stored on the target resource(s) in the <code>topics</code> property.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>The service is designed to possibly manage a different topic per platform (e.g. ANDROID / IOS), although at the present time the same topic is used by all platforms because by default SNS topics are cross-platforms.</p></div> <p>For instance the topics associated to a group will result in the following structure on the group object:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    _id<span class="token operator">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">'5f568ba1fc54a1002fe6fe37'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'Centre de Castelnaudary'</span><span class="token punctuation">,</span>
    topics<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token constant">ANDROID</span><span class="token operator">:</span> <span class="token string">'arn:aws:sns:eu-west-1:xxx'</span><span class="token punctuation">,</span>
        <span class="token constant">IOS</span><span class="token operator">:</span> <span class="token string">'arn:aws:sns:eu-west-1:xxx'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Last but not least, This service helps publishing messages to SNS devices or topics.</p> <p>As a consequence, the <code>create</code>/<code>remove</code> operations have to be called with an <code>action</code> property indicating the target SNS operations among <code>device</code>, <code>topic</code>, <code>subscriptions</code> and <code>message</code>. The payload varies according to the selected target operation:</p> <ul><li><code>device</code>:
<ul><li><strong>device</strong> as data: device object with SNS ARN and/or registration ID (i.e. token) for APNS or Firebase</li></ul></li> <li><code>topic</code>:
<ul><li><strong>pushObject</strong> as params: target resource owing the topic</li> <li><strong>pushService</strong> as params: target resource service</li> <li><strong>topicField</strong> as data/query: target property to store the topic</li></ul></li> <li><code>subscriptions</code> <ul><li><strong>pushObject</strong> as params: target resource owing the topic</li> <li><strong>users</strong> as params: target subject(s) to subscribe to topic</li> <li><strong>topicField</strong> as data/query: target property to store the topic</li></ul></li> <li><code>message</code> <ul><li><strong>pushObject</strong> as params: target resource owing the topic if topic</li> <li><strong>pushService</strong> as params: target resource service</li> <li><strong>message</strong> as data: message payload</li></ul></li></ul> <h3 id="hooks-4"><a href="#hooks-4" class="header-anchor">#</a> Hooks</h3> <p>The following <a href="/kdk/api/core/hooks.html">hooks</a> are executed on the <code>pusher</code> service:</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><h2 id="account-service"><a href="#account-service" class="header-anchor">#</a> Account service</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Available as a global service</p></div> <p>This service is powered by <a href="https://github.com/feathersjs-ecosystem/feathers-authentication-management" target="_blank" rel="noopener noreferrer">feathers-authentication-management<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h3 id="data-model-4"><a href="#data-model-4" class="header-anchor">#</a> Data model</h3> <p>This service consists in associating verification tokens to users so that they can safely reset their password or change their email, please refer to <a href="https://github.com/feathersjs-ecosystem/feathers-authentication-management" target="_blank" rel="noopener noreferrer">feathers-authentication-management docs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h3 id="hooks-5"><a href="#hooks-5" class="header-anchor">#</a> Hooks</h3> <p>The following <a href="/kdk/api/core/hooks.html">hooks</a> are executed on the <code>account</code> service:</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><h3 id="testing"><a href="#testing" class="header-anchor">#</a> Testing</h3> <p>To make test run we need two gmail accounts:</p> <ul><li><code>email-notifications@kalisio.com</code> used as email sender</li> <li><code>test@kalisio.com</code> used as user test email</li></ul> <blockquote><p>When testing identity change we also use the <code>test@kalisio.xyz</code> address as user test email. However to avoid creating a new account in Google you can simply add an alias for this address to the <code>test@kalisio.com</code> account.</p></blockquote> <p>The first email account is used by the <a href="/kdk/api/core/services.html#mailer-service">mailer service</a> to send email notifications. The second email account requires OAuth2 authentication to be able to read emails using the GMail API. The simplest way is by creating a service account for a JWT-based authentication. Interesting issue to make all the configuration work can be found <a href="https://stackoverflow.com/a/29328258" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, notably you have to delegate domain-wide authority to the service account in order to authorize your app to access user data on behalf of users and authorise the client ID of the service account with scopes <code>https://mail.google.com/,https://www.googleapis.com/auth/gmail.readonly</code>.</p> <p>Standard OAuth2 with refresh token might also be used as detailed <a href="https://medium.com/@pandeysoni/nodemailer-service-in-node-js-using-smtp-and-xoauth2-7c638a39a37e" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and <a href="https://medium.com/@pandeysoni/nodemailer-service-in-node-js-using-smtp-and-xoauth2-7c638a39a37e" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Details on how to use Google APIs from Node.js <a href="https://github.com/google/google-api-nodejs-client#authorizing-and-authenticating" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <blockquote><p>Some anti-virus or firewalls softwares intercept HTTPS traffic, decrypting it, and then encrypting it using a self-signed certificate causing a &quot;<em>Self-Signed Certificate in Certificate Chain</em>&quot; error. If so deactivate the SSL analysys in your software, <a href="https://github.com/CawaMS/StorageExplorerTroubleshootingGuide/blob/master/se-troubleshooting-guide.md" target="_blank" rel="noopener noreferrer">this might help<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p></blockquote> <h2 id="authorisations-service"><a href="#authorisations-service" class="header-anchor">#</a> Authorisations service</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Available as a global service</p></div> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p><code>create</code> and <code>remove</code> methods are the only one allowed from the client/server side</p></div> <h3 id="data-model-5"><a href="#data-model-5" class="header-anchor">#</a> Data model</h3> <p>An authorisation consists in associating a <em>resource</em> object (e.g. a group) with a <em>subject</em> object (e.g. a user) according to a <em>permission</em> (i.e. a role or a right). The resource object information and the permission are directly stored on the target subject(s) in a property called the <em>scope</em> of the authorisation (e.g. <code>groups</code> to store all groups a user belongs to).</p> <p>For instance the groups a user belongs to with different roles will result in the following structure on the user:</p> <div class="language-js extra-class"><pre class="language-js"><code>groups<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
      _id<span class="token operator">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">'5f568ba1fc54a1002fe6fe37'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> <span class="token string">'Centre de Castelnaudary'</span><span class="token punctuation">,</span>
      context<span class="token operator">:</span> <span class="token string">'5f55f4169f6d47002f05f4ac'</span><span class="token punctuation">,</span>
      permissions<span class="token operator">:</span> <span class="token string">'owner'</span>
      <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
      _id<span class="token operator">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">'5f64a3791a1714002f68437d'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> <span class="token string">'Kalisio'</span><span class="token punctuation">,</span>
      context<span class="token operator">:</span> <span class="token string">'5f532d439f6d47002f04f07e'</span><span class="token punctuation">,</span>
      permissions<span class="token operator">:</span> <span class="token string">'manager'</span>
      <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
      _id<span class="token operator">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">'5f65e34a75b663003095f52e'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> <span class="token string">'LTD'</span><span class="token punctuation">,</span>
      context<span class="token operator">:</span> <span class="token string">'5f65d98084f9d5003039b55b'</span><span class="token punctuation">,</span>
      permissions<span class="token operator">:</span> <span class="token string">'member'</span>
      <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><h3 id="hooks-6"><a href="#hooks-6" class="header-anchor">#</a> Hooks</h3> <p>The following <a href="/kdk/api/core/hooks.html">hooks</a> are executed on the <code>authorisations</code> service:</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><h2 id="tags-service"><a href="#tags-service" class="header-anchor">#</a> Tags service</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Available as a global and a contextual service</p></div> <p>Tags can be created directly using this service or by &quot;tagging&quot; a target resource (e.g. a user). As a consequence, <code>create</code>/<code>remove</code> operations can include a target resource as input data/ID.</p> <p>Due to this behaviour tags are created/removed by value, not by ID. To avoid duplication when tagging multiple resources with the same tag, the service manages a reference count on tag objects and they are automatically created/removed accordingly.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p><code>remove</code> method can be called with a resource ID</p></div> <h3 id="data-model-6"><a href="#data-model-6" class="header-anchor">#</a> Data model</h3> <p>The data model of a tag as used by the API is <a href="/kdk/architecture/data-model-view.html#tag-data-model">detailed here</a>.</p> <h3 id="hooks-7"><a href="#hooks-7" class="header-anchor">#</a> Hooks</h3> <p>The following <a href="/kdk/api/core/hooks.html">hooks</a> are executed on the <code>tags</code> service:</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><h2 id="storage-service"><a href="#storage-service" class="header-anchor">#</a> Storage service</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Available as a global and a contextual service</p></div> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p><code>get</code>, <code>create</code> and <code>remove</code> methods are the only one allowed from the client/server side</p></div> <p>Blobs can be created directly using this service or through &quot;attachment&quot; to a target resource (e.g. a user).</p> <p>This service heavily relies on <a href="https://github.com/feathersjs-ecosystem/feathers-blob" target="_blank" rel="noopener noreferrer">feathers-blob<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and <a href="https://github.com/expressjs/multer" target="_blank" rel="noopener noreferrer">multer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for handling <a href="https://docs.feathersjs.com/guides/advanced/file-uploading.html#feathers-blob-with-multipart-support" target="_blank" rel="noopener noreferrer">multipart/form-data<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h3 id="data-model-7"><a href="#data-model-7" class="header-anchor">#</a> Data model</h3> <p>No data model, data are directly stored on target storage backend (i.e. AWS S3).</p> <h3 id="hooks-8"><a href="#hooks-8" class="header-anchor">#</a> Hooks</h3> <p>The following <a href="/kdk/api/core/hooks.html">hooks</a> are executed on the <code>storage</code> service:</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><h2 id="databases-service"><a href="#databases-service" class="header-anchor">#</a> Databases service</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Available as a global service</p></div> <p>This service is powered by <a href="https://github.com/feathersjs-ecosystem/feathers-mongodb-management" target="_blank" rel="noopener noreferrer">feathers-mongodb-management<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. It acts as a proxy to perform MongoDB operations like creating databases, collections or users.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Service methods are only allowed from the server side</p></div> <h3 id="hooks-9"><a href="#hooks-9" class="header-anchor">#</a> Hooks</h3> <p>The following <a href="/kdk/api/core/hooks.html">hooks</a> are executed on the <code>databases</code> service:</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><h2 id="organisations-service"><a href="#organisations-service" class="header-anchor">#</a> Organisations service</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Available as a global service</p></div> <p>This service exhibits the following methods in addition to standard CRUD operations:</p> <ul><li><strong>createOrganisationServices</strong>: creates all registered services for an organisation</li> <li><strong>removeOrganisationServices</strong>: removes registered services for an organisation</li> <li><strong>registerOrganisationServicesHook(hook)</strong>: register a function to create additional services per organisation</li> <li><strong>unregisterOrganisationServicesHook(hook)</strong>: unregister a previously registered function</li></ul> <p>A hook function has the following structure:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token function-variable function">createOrganisationServices</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">organisation<span class="token punctuation">,</span> db</span><span class="token punctuation">)</span>
  <span class="token function-variable function">removeOrganisationServices</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">organisation<span class="token punctuation">,</span> db</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>By default the following services are created for an organisation: <a href="/kdk/api/core/services.html#members-service">members</a>, <a href="/kdk/api/core/services.html#tags-service">tags</a>, <a href="/kdk/api/core/services.html#groups-service">groups</a>, <a href="/kdk/api/core/services.html#storage-service">storage</a>.</p></div> <h3 id="data-model-8"><a href="#data-model-8" class="header-anchor">#</a> Data model</h3> <p>The data model of an organisation as used by the API is <a href="/kdk/architecture/data-model-view.html#organisation-data-model">detailed here</a>.</p> <h3 id="hooks-10"><a href="#hooks-10" class="header-anchor">#</a> Hooks</h3> <p>No specific <a href="/kdk/api/core/hooks.html">hooks</a> are executed on the <code>organisations</code> service.</p> <h2 id="members-service"><a href="#members-service" class="header-anchor">#</a> Members service</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Available as a contextual service</p></div> <p>This service is a proxy to the <a href="/kdk/api/core/service.html#users-service">users service</a> available at the organisation level in order to filter users belonging to it.</p> <h3 id="data-model-9"><a href="#data-model-9" class="header-anchor">#</a> Data model</h3> <p>The data model of a member as used by the API is a the one of a <a href="/kdk/architecture/data-model-view.html#user-data-model">user</a>.</p> <h3 id="hooks-11"><a href="#hooks-11" class="header-anchor">#</a> Hooks</h3> <p>No specific <a href="/kdk/api/core/hooks.html">hooks</a> are executed on the <code>members</code> service.</p> <h2 id="groups-service"><a href="#groups-service" class="header-anchor">#</a> Groups service</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Available as a contextual service</p></div> <h3 id="data-model-10"><a href="#data-model-10" class="header-anchor">#</a> Data model</h3> <p>The data model of a group as used by the API is <a href="/kdk/architecture/data-model-view.html#group-data-model">detailed here</a>.</p> <h3 id="hooks-12"><a href="#hooks-12" class="header-anchor">#</a> Hooks</h3> <p>The following <a href="/kdk/api/core/hooks.html">hooks</a> are executed on the <code>groups</code> service:</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><h2 id="local-settings-service"><a href="#local-settings-service" class="header-anchor">#</a> Local settings service</h2> <p>This <strong>client-side</strong> service allows to restore/save persistent settings to/from the <a href="/kdk/api/core/application.html#store">global store</a> from/to <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage" target="_blank" rel="noopener noreferrer">local storage<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p><code>get</code> and <code>patch</code> methods are the only one allowed, <code>id</code> parameter is ignored and methods will always target the whole settings object</p></div> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>This service has to be instanciated at application level, none provided by default</p></div> <p>To create your own service use the following code:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Store<span class="token punctuation">,</span> LocalSettingsService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@kalisio/kdk/core.client'</span>

<span class="token comment">// Setup defaults in global store</span>
Store<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'app-settings'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> x<span class="token operator">:</span> y<span class="token punctuation">,</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// Create a service targeting only settings in store</span>
<span class="token keyword">const</span> settingsService <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">createService</span><span class="token punctuation">(</span><span class="token string">'settings'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  service<span class="token operator">:</span> LocalSettingsService<span class="token punctuation">,</span>
  propertyMapping<span class="token operator">:</span> <span class="token punctuation">{</span>
    x<span class="token operator">:</span> <span class="token string">'app-settings.x'</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// Restore previous settings from local storage if any</span>
settingsService<span class="token punctuation">.</span><span class="token function">restoreSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Because settings are available through a service interface you can edit it using the <a href="/kdk/api/core/components.html#editors">editor system</a>. The <code>propertyMapping</code> will be used to match form field names and corresponding global store properties.</p></div> <p>For instance the following schema can be used to edit the previous sample:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;$schema&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://json-schema.org/draft-06/schema#&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;$id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://www.kalisio.xyz/schemas/settings.update.json#&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;schemas.UPDATE_SETTINGS_TITLE&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;object&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;x&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span> 
      <span class="token property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;component&quot;</span><span class="token operator">:</span> <span class="token string">&quot;form/KTextField&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;helper&quot;</span><span class="token operator">:</span> <span class="token string">&quot;schemas.X_FIELD_HELPER&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      
      <a href="/kdk/api/core/application.html" class="prev">
        Application
      </a></span> <span class="next"><a href="/kdk/api/core/hooks.html">
        Hooks
      </a>
      
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/kdk/assets/js/app.96fe67fb.js" defer></script><script src="/kdk/assets/js/3.e14f8819.js" defer></script><script src="/kdk/assets/js/33.28443a0b.js" defer></script><script src="/kdk/assets/js/9.cdfb28c3.js" defer></script>
  </body>
</html>
