import{_ as p,C as c,o as e,c as i,b as t,w as s,Z as l,Q as a,H as n,a as r}from"./chunks/framework.70a39c86.js";const w=JSON.parse('{"title":"Services","description":"","frontmatter":{},"headers":[],"relativePath":"api/core/services.md","filePath":"api/core/services.md"}'),E={name:"api/core/services.md"},h=a('<h1 id="services" tabindex="-1">Services <a class="header-anchor" href="#services" aria-label="Permalink to &quot;Services&quot;">​</a></h1><h2 id="users-service" tabindex="-1">Users service <a class="header-anchor" href="#users-service" aria-label="Permalink to &quot;Users service&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Available as a global service</p></div><h3 id="data-model" tabindex="-1">Data model <a class="header-anchor" href="#data-model" aria-label="Permalink to &quot;Data model&quot;">​</a></h3><p>The data model of a user as used by the API is <a href="./../../architecture/data-model-view.html#user-data-model">detailed here</a>.</p><h3 id="hooks" tabindex="-1">Hooks <a class="header-anchor" href="#hooks" aria-label="Permalink to &quot;Hooks&quot;">​</a></h3><p>The following <a href="./hooks.html">hooks</a> are executed on the <code>users</code> service:</p>',7),d=a('<h2 id="devices-service" tabindex="-1">Devices service <a class="header-anchor" href="#devices-service" aria-label="Permalink to &quot;Devices service&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Available as a global service</p></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p><code>update</code> and <code>remove</code> methods are the only ones allowed from the client side <code>create</code> method is only allowed from the server side</p></div><p><code>create</code> (respectively <code>remove</code>) creates (respectively removes) the device to/from the notification system (APNS or Firebase). <code>update</code> updates the device registration ID or create it if not yet created.</p><h3 id="data-model-1" tabindex="-1">Data model <a class="header-anchor" href="#data-model-1" aria-label="Permalink to &quot;Data model&quot;">​</a></h3><p>The data model of a device as used by the API is <a href="./../../architecture/data-model-view.html#device-data-model">detailed here</a>.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Devices are store in the <code>devices</code> property of the user they belong to.</p></div><h3 id="hooks-1" tabindex="-1">Hooks <a class="header-anchor" href="#hooks-1" aria-label="Permalink to &quot;Hooks&quot;">​</a></h3><p>The following <a href="./hooks.html">hooks</a> are executed on the <code>devices</code> service:</p>',9),u=a('<h2 id="mailer-service" tabindex="-1">Mailer service <a class="header-anchor" href="#mailer-service" aria-label="Permalink to &quot;Mailer service&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Available as a global service</p></div><p>This service is powered by <a href="https://github.com/feathersjs-ecosystem/feathers-mailer" target="_blank" rel="noreferrer">feathers-mailer</a>. It acts as a proxy to send emails through an SMTP server.</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Service methods are only allowed from the server side. <code>create</code> is the sole available method used to send an email.</p></div><div class="warning custom-block"><p class="custom-block-title">DEPRECATION NOTICE</p><p>The email account can authorise connection by email/password on <a href="https://myaccount.google.com/lesssecureapps" target="_blank" rel="noreferrer">https://myaccount.google.com/lesssecureapps</a>. Before that the domain admin should allow him to manage this setting (<em>Admin Console &gt; Security &gt; General &gt; Less secure apps settings</em>). To avoid changing it for all users first create a group, add the user to the group and let the group manage less secure apps setting.</p></div><p>On 15 february 2021 Gmail API requires OAuth2 authentication to send emails. The simplest solution is to create a <a href="https://medium.com/@imre_7961/nodemailer-with-g-suite-oauth2-4c86049f778a" target="_blank" rel="noreferrer">service account</a> and to <a href="https://developers.google.com/identity/protocols/oauth2/service-account" target="_blank" rel="noreferrer">delegate the domain-wide authority to the service account</a> with scope <code>https://mail.google.com</code>.</p><h3 id="hooks-2" tabindex="-1">Hooks <a class="header-anchor" href="#hooks-2" aria-label="Permalink to &quot;Hooks&quot;">​</a></h3><p>The following <a href="./hooks.html">hooks</a> are executed on the <code>databases</code> service:</p>',8),A=a(`<h2 id="pusher-service" tabindex="-1">Pusher service <a class="header-anchor" href="#pusher-service" aria-label="Permalink to &quot;Pusher service&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Available as a global service</p></div><p>This service relies on <a href="https://github.com/kalisio/sns-mobile" target="_blank" rel="noreferrer">sns-mobile</a>, which has a <a href="http://evanshortiss.com/development/mobile/2014/02/22/sns-push-notifications-using-nodejs.html" target="_blank" rel="noreferrer">nice tutorial</a>, to manage the link between <a href="https://aws.amazon.com/sns" target="_blank" rel="noreferrer">AWS SNS</a> and internal resource objects in order to send push notifications to users.</p><p>To get an API access/secret key you need to create a new user in IAM with a role giving access to SNS like <code>AmazonSNSFullAccess</code> but in production <a href="http://docs.aws.amazon.com/sns/latest/dg/UsingIAMwithSNS.html" target="_blank" rel="noreferrer">you should control access more precisely</a>.</p><p>Since 2017 Google Cloud Messaging (GCM) has become Firebase Cloud Messaging (FCM), to generate an API key follow <a href="https://stackoverflow.com/questions/39417797/amazon-sns-platform-credentials-are-invalid-when-re-entering-a-gcm-api-key-th" target="_blank" rel="noreferrer">this issue</a> and enter the server key when creating the SNS application on AWS. Although you use the Firebase console you should also see the created API through the Google Cloud console.</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p><code>create</code> and <code>remove</code> methods are the only one allowed from the server side</p></div><h3 id="data-model-2" tabindex="-1">Data model <a class="header-anchor" href="#data-model-2" aria-label="Permalink to &quot;Data model&quot;">​</a></h3><p>This service helps (un)registering devices to/from SNS and create/remove SNS topics. This service also helps associating a <em>resource</em> object (e.g. a group) with a SNS <em>topic</em> to provide push notifications to the users associated with the resource. SNS ARNs are directly stored on the target resource(s) in the <code>topics</code> property.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>The service is designed to possibly manage a different topic per platform (e.g. ANDROID / IOS), although at the present time the same topic is used by all platforms because by default SNS topics are cross-platforms.</p></div><p>For instance the topics associated to a group will result in the following structure on the group object:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">_id</span><span style="color:#E1E4E8;">: </span><span style="color:#B392F0;">ObjectId</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;5f568ba1fc54a1002fe6fe37&#39;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;Centre de Castelnaudary&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">topics</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">ANDROID</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;arn:aws:sns:eu-west-1:xxx&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">IOS</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;arn:aws:sns:eu-west-1:xxx&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">_id</span><span style="color:#24292E;">: </span><span style="color:#6F42C1;">ObjectId</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;5f568ba1fc54a1002fe6fe37&#39;</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;Centre de Castelnaudary&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">topics</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">ANDROID</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;arn:aws:sns:eu-west-1:xxx&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">IOS</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;arn:aws:sns:eu-west-1:xxx&#39;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>Last but not least, This service helps publishing messages to SNS devices or topics.</p><p>As a consequence, the <code>create</code>/<code>remove</code> operations have to be called with an <code>action</code> property indicating the target SNS operations among <code>device</code>, <code>topic</code>, <code>subscriptions</code> and <code>message</code>. The payload varies according to the selected target operation:</p><ul><li><code>device</code>: <ul><li><strong>device</strong> as data: device object with SNS ARN and/or registration ID (i.e. token) for APNS or Firebase</li></ul></li><li><code>topic</code>: <ul><li><strong>pushObject</strong> as params: target resource owing the topic</li><li><strong>pushService</strong> as params: target resource service</li><li><strong>topicField</strong> as data/query: target property to store the topic</li></ul></li><li><code>subscriptions</code><ul><li><strong>pushObject</strong> as params: target resource owing the topic</li><li><strong>users</strong> as params: target subject(s) to subscribe to topic</li><li><strong>topicField</strong> as data/query: target property to store the topic</li></ul></li><li><code>message</code><ul><li><strong>pushObject</strong> as params: target resource owing the topic if topic</li><li><strong>pushService</strong> as params: target resource service</li><li><strong>message</strong> as data: message payload</li></ul></li></ul><h3 id="hooks-3" tabindex="-1">Hooks <a class="header-anchor" href="#hooks-3" aria-label="Permalink to &quot;Hooks&quot;">​</a></h3><p>The following <a href="./hooks.html">hooks</a> are executed on the <code>pusher</code> service:</p>`,16),m=a('<h2 id="account-service" tabindex="-1">Account service <a class="header-anchor" href="#account-service" aria-label="Permalink to &quot;Account service&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Available as a global service</p></div><p>This service is powered by <a href="https://github.com/feathersjs-ecosystem/feathers-authentication-management" target="_blank" rel="noreferrer">feathers-authentication-management</a>.</p><h3 id="data-model-3" tabindex="-1">Data model <a class="header-anchor" href="#data-model-3" aria-label="Permalink to &quot;Data model&quot;">​</a></h3><p>This service consists in associating verification tokens to users so that they can safely reset their password or change their email, please refer to <a href="https://github.com/feathersjs-ecosystem/feathers-authentication-management" target="_blank" rel="noreferrer">feathers-authentication-management docs</a>.</p><h3 id="hooks-4" tabindex="-1">Hooks <a class="header-anchor" href="#hooks-4" aria-label="Permalink to &quot;Hooks&quot;">​</a></h3><p>The following <a href="./hooks.html">hooks</a> are executed on the <code>account</code> service:</p>',7),f=a(`<h3 id="testing" tabindex="-1">Testing <a class="header-anchor" href="#testing" aria-label="Permalink to &quot;Testing&quot;">​</a></h3><p>To make test run we need two gmail accounts:</p><ul><li><code>email-notifications@kalisio.com</code> used as email sender</li><li><code>test@kalisio.com</code> used as user test email</li></ul><blockquote><p>When testing identity change we also use the <code>test@kalisio.xyz</code> address as user test email. However to avoid creating a new account in Google you can simply add an alias for this address to the <code>test@kalisio.com</code> account.</p></blockquote><p>The first email account is used by the <a href="./services.html#mailer-service">mailer service</a> to send email notifications. The second email account requires OAuth2 authentication to be able to read emails using the GMail API. The simplest way is by creating a service account for a JWT-based authentication. Interesting issue to make all the configuration work can be found <a href="https://stackoverflow.com/a/29328258" target="_blank" rel="noreferrer">here</a>, notably you have to delegate domain-wide authority to the service account in order to authorize your app to access user data on behalf of users and authorise the client ID of the service account with scopes <code>https://mail.google.com/,https://www.googleapis.com/auth/gmail.readonly</code>.</p><p>Standard OAuth2 with refresh token might also be used as detailed <a href="https://medium.com/@pandeysoni/nodemailer-service-in-node-js-using-smtp-and-xoauth2-7c638a39a37e" target="_blank" rel="noreferrer">here</a> and <a href="https://medium.com/@pandeysoni/nodemailer-service-in-node-js-using-smtp-and-xoauth2-7c638a39a37e" target="_blank" rel="noreferrer">here</a>.</p><p>Details on how to use Google APIs from Node.js <a href="https://github.com/google/google-api-nodejs-client#authorizing-and-authenticating" target="_blank" rel="noreferrer">here</a>.</p><blockquote><p>Some anti-virus or firewalls softwares intercept HTTPS traffic, decrypting it, and then encrypting it using a self-signed certificate causing a &quot;<em>Self-Signed Certificate in Certificate Chain</em>&quot; error. If so deactivate the SSL analysys in your software, <a href="https://github.com/CawaMS/StorageExplorerTroubleshootingGuide/blob/master/se-troubleshooting-guide.md" target="_blank" rel="noreferrer">this might help</a>.</p></blockquote><h2 id="authorisations-service" tabindex="-1">Authorisations service <a class="header-anchor" href="#authorisations-service" aria-label="Permalink to &quot;Authorisations service&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Available as a global service</p></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p><code>create</code> and <code>remove</code> methods are the only one allowed from the client/server side</p></div><h3 id="data-model-4" tabindex="-1">Data model <a class="header-anchor" href="#data-model-4" aria-label="Permalink to &quot;Data model&quot;">​</a></h3><p>An authorisation consists in associating a <em>resource</em> object (e.g. a group) with a <em>subject</em> object (e.g. a user) according to a <em>permission</em> (i.e. a role or a right). The resource object information and the permission are directly stored on the target subject(s) in a property called the <em>scope</em> of the authorisation (e.g. <code>groups</code> to store all groups a user belongs to).</p><p>For instance the groups a user belongs to with different roles will result in the following structure on the user:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">groups</span><span style="color:#E1E4E8;">: [</span></span>
<span class="line"><span style="color:#E1E4E8;">  {</span></span>
<span class="line"><span style="color:#E1E4E8;">      _id: </span><span style="color:#B392F0;">ObjectId</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;5f568ba1fc54a1002fe6fe37&#39;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">      name: </span><span style="color:#9ECBFF;">&#39;Centre de Castelnaudary&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      context: </span><span style="color:#9ECBFF;">&#39;5f55f4169f6d47002f05f4ac&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      permissions: </span><span style="color:#9ECBFF;">&#39;owner&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">...</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#E1E4E8;">  {</span></span>
<span class="line"><span style="color:#E1E4E8;">      _id: </span><span style="color:#B392F0;">ObjectId</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;5f64a3791a1714002f68437d&#39;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">      name: </span><span style="color:#9ECBFF;">&#39;Kalisio&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      context: </span><span style="color:#9ECBFF;">&#39;5f532d439f6d47002f04f07e&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      permissions: </span><span style="color:#9ECBFF;">&#39;manager&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">...</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#E1E4E8;">  {</span></span>
<span class="line"><span style="color:#E1E4E8;">      _id: </span><span style="color:#B392F0;">ObjectId</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;5f65e34a75b663003095f52e&#39;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">      name: </span><span style="color:#9ECBFF;">&#39;LTD&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      context: </span><span style="color:#9ECBFF;">&#39;5f65d98084f9d5003039b55b&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      permissions: </span><span style="color:#9ECBFF;">&#39;member&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">...</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">]</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">groups</span><span style="color:#24292E;">: [</span></span>
<span class="line"><span style="color:#24292E;">  {</span></span>
<span class="line"><span style="color:#24292E;">      _id: </span><span style="color:#6F42C1;">ObjectId</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;5f568ba1fc54a1002fe6fe37&#39;</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">      name: </span><span style="color:#032F62;">&#39;Centre de Castelnaudary&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      context: </span><span style="color:#032F62;">&#39;5f55f4169f6d47002f05f4ac&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      permissions: </span><span style="color:#032F62;">&#39;owner&#39;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">...</span></span>
<span class="line"><span style="color:#24292E;">  },</span></span>
<span class="line"><span style="color:#24292E;">  {</span></span>
<span class="line"><span style="color:#24292E;">      _id: </span><span style="color:#6F42C1;">ObjectId</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;5f64a3791a1714002f68437d&#39;</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">      name: </span><span style="color:#032F62;">&#39;Kalisio&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      context: </span><span style="color:#032F62;">&#39;5f532d439f6d47002f04f07e&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      permissions: </span><span style="color:#032F62;">&#39;manager&#39;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">...</span></span>
<span class="line"><span style="color:#24292E;">  },</span></span>
<span class="line"><span style="color:#24292E;">  {</span></span>
<span class="line"><span style="color:#24292E;">      _id: </span><span style="color:#6F42C1;">ObjectId</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;5f65e34a75b663003095f52e&#39;</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">      name: </span><span style="color:#032F62;">&#39;LTD&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      context: </span><span style="color:#032F62;">&#39;5f65d98084f9d5003039b55b&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      permissions: </span><span style="color:#032F62;">&#39;member&#39;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">...</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">]</span></span></code></pre></div><h3 id="hooks-5" tabindex="-1">Hooks <a class="header-anchor" href="#hooks-5" aria-label="Permalink to &quot;Hooks&quot;">​</a></h3><p>The following <a href="./hooks.html">hooks</a> are executed on the <code>authorisations</code> service:</p>`,17),y=a('<h2 id="tags-service" tabindex="-1">Tags service <a class="header-anchor" href="#tags-service" aria-label="Permalink to &quot;Tags service&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Available as a global and a contextual service</p></div><p>Tags can be created directly using this service or by &quot;tagging&quot; a target resource (e.g. a user). As a consequence, <code>create</code>/<code>remove</code> operations can include a target resource as input data/ID.</p><p>Due to this behaviour tags are created/removed by value, not by ID. To avoid duplication when tagging multiple resources with the same tag, the service manages a reference count on tag objects and they are automatically created/removed accordingly.</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p><code>remove</code> method can be called with a resource ID</p></div><h3 id="data-model-5" tabindex="-1">Data model <a class="header-anchor" href="#data-model-5" aria-label="Permalink to &quot;Data model&quot;">​</a></h3><p>The data model of a tag as used by the API is <a href="./../../architecture/data-model-view.html#tag-data-model">detailed here</a>.</p><h3 id="hooks-6" tabindex="-1">Hooks <a class="header-anchor" href="#hooks-6" aria-label="Permalink to &quot;Hooks&quot;">​</a></h3><p>The following <a href="./hooks.html">hooks</a> are executed on the <code>tags</code> service:</p>',9),k=a('<h2 id="storage-service" tabindex="-1">Storage service <a class="header-anchor" href="#storage-service" aria-label="Permalink to &quot;Storage service&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Available as a global and a contextual service</p></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p><code>get</code>, <code>create</code> and <code>remove</code> methods are the only one allowed from the client/server side</p></div><p>Blobs can be created directly using this service or through &quot;attachment&quot; to a target resource (e.g. a user).</p><p>This service heavily relies on <a href="https://github.com/feathersjs-ecosystem/feathers-blob" target="_blank" rel="noreferrer">feathers-blob</a> and <a href="https://github.com/expressjs/multer" target="_blank" rel="noreferrer">multer</a> for handling <a href="https://docs.feathersjs.com/guides/advanced/file-uploading.html#feathers-blob-with-multipart-support" target="_blank" rel="noreferrer">multipart/form-data</a>.</p><h3 id="data-model-6" tabindex="-1">Data model <a class="header-anchor" href="#data-model-6" aria-label="Permalink to &quot;Data model&quot;">​</a></h3><p>No data model, data are directly stored on target storage backend (i.e. AWS S3).</p><h3 id="hooks-7" tabindex="-1">Hooks <a class="header-anchor" href="#hooks-7" aria-label="Permalink to &quot;Hooks&quot;">​</a></h3><p>The following <a href="./hooks.html">hooks</a> are executed on the <code>storage</code> service:</p>',9),C=a('<h2 id="databases-service" tabindex="-1">Databases service <a class="header-anchor" href="#databases-service" aria-label="Permalink to &quot;Databases service&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Available as a global service</p></div><p>This service is powered by <a href="https://github.com/feathersjs-ecosystem/feathers-mongodb-management" target="_blank" rel="noreferrer">feathers-mongodb-management</a>. It acts as a proxy to perform MongoDB operations like creating databases, collections or users.</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Service methods are only allowed from the server side</p></div><h3 id="hooks-8" tabindex="-1">Hooks <a class="header-anchor" href="#hooks-8" aria-label="Permalink to &quot;Hooks&quot;">​</a></h3><p>The following <a href="./hooks.html">hooks</a> are executed on the <code>databases</code> service:</p>',6),g=a(`<h2 id="organisations-service" tabindex="-1">Organisations service <a class="header-anchor" href="#organisations-service" aria-label="Permalink to &quot;Organisations service&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Available as a global service</p></div><p>This service exhibits the following methods in addition to standard CRUD operations:</p><ul><li><strong>createOrganisationServices</strong>: creates all registered services for an organisation</li><li><strong>removeOrganisationServices</strong>: removes registered services for an organisation</li><li><strong>registerOrganisationServicesHook(hook)</strong>: register a function to create additional services per organisation</li><li><strong>unregisterOrganisationServicesHook(hook)</strong>: unregister a previously registered function</li></ul><p>A hook function has the following structure:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">createOrganisationServices</span><span style="color:#E1E4E8;">: </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">organisation</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">db</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">removeOrganisationServices</span><span style="color:#E1E4E8;">: </span><span style="color:#B392F0;">function</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">organisation</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">db</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">createOrganisationServices</span><span style="color:#24292E;">: </span><span style="color:#D73A49;">function</span><span style="color:#24292E;">(</span><span style="color:#E36209;">organisation</span><span style="color:#24292E;">, </span><span style="color:#E36209;">db</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">removeOrganisationServices</span><span style="color:#24292E;">: </span><span style="color:#6F42C1;">function</span><span style="color:#24292E;">(</span><span style="color:#E36209;">organisation</span><span style="color:#24292E;">, </span><span style="color:#E36209;">db</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>By default the following services are created for an organisation: <a href="./services.html#members-service">members</a>, <a href="./services.html#tags-service">tags</a>, <a href="./services.html#groups-service">groups</a>, <a href="./services.html#storage-service">storage</a>.</p></div><h3 id="data-model-7" tabindex="-1">Data model <a class="header-anchor" href="#data-model-7" aria-label="Permalink to &quot;Data model&quot;">​</a></h3><p>The data model of an organisation as used by the API is <a href="./../../architecture/data-model-view.html#organisation-data-model">detailed here</a>.</p><h3 id="hooks-9" tabindex="-1">Hooks <a class="header-anchor" href="#hooks-9" aria-label="Permalink to &quot;Hooks&quot;">​</a></h3><p>No specific <a href="./hooks.html">hooks</a> are executed on the <code>organisations</code> service.</p><h2 id="members-service" tabindex="-1">Members service <a class="header-anchor" href="#members-service" aria-label="Permalink to &quot;Members service&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Available as a contextual service</p></div><p>This service is a proxy to the <a href="./service.html#users-service">users service</a> available at the organisation level in order to filter users belonging to it.</p><h3 id="data-model-8" tabindex="-1">Data model <a class="header-anchor" href="#data-model-8" aria-label="Permalink to &quot;Data model&quot;">​</a></h3><p>The data model of a member as used by the API is a the one of a <a href="./../../architecture/data-model-view.html#user-data-model">user</a>.</p><h3 id="hooks-10" tabindex="-1">Hooks <a class="header-anchor" href="#hooks-10" aria-label="Permalink to &quot;Hooks&quot;">​</a></h3><p>No specific <a href="./hooks.html">hooks</a> are executed on the <code>members</code> service.</p><h2 id="groups-service" tabindex="-1">Groups service <a class="header-anchor" href="#groups-service" aria-label="Permalink to &quot;Groups service&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Available as a contextual service</p></div><h3 id="data-model-9" tabindex="-1">Data model <a class="header-anchor" href="#data-model-9" aria-label="Permalink to &quot;Data model&quot;">​</a></h3><p>The data model of a group as used by the API is <a href="./../../architecture/data-model-view.html#group-data-model">detailed here</a>.</p><h3 id="hooks-11" tabindex="-1">Hooks <a class="header-anchor" href="#hooks-11" aria-label="Permalink to &quot;Hooks&quot;">​</a></h3><p>The following <a href="./hooks.html">hooks</a> are executed on the <code>groups</code> service:</p>`,24),b=a(`<h2 id="local-settings-service" tabindex="-1">Local settings service <a class="header-anchor" href="#local-settings-service" aria-label="Permalink to &quot;Local settings service&quot;">​</a></h2><p>This <strong>client-side</strong> service allows to restore/save persistent settings to/from the <a href="./application.html#store">global store</a> from/to <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage" target="_blank" rel="noreferrer">local storage</a>.</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p><code>get</code> and <code>patch</code> methods are the only one allowed, <code>id</code> parameter is ignored and methods will always target the whole settings object</p></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>This service has to be instanciated at application level, none provided by default</p></div><p>To create your own service use the following code:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { Store, LocalSettingsService } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;@kalisio/kdk/core.client&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Setup defaults in global store</span></span>
<span class="line"><span style="color:#E1E4E8;">Store.</span><span style="color:#B392F0;">set</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;app-settings&#39;</span><span style="color:#E1E4E8;">, { x: y, </span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;"> })</span></span>
<span class="line"><span style="color:#6A737D;">// Create a service targeting only settings in store</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">settingsService</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> api.</span><span style="color:#B392F0;">createService</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;settings&#39;</span><span style="color:#E1E4E8;">, {</span></span>
<span class="line"><span style="color:#E1E4E8;">  service: LocalSettingsService,</span></span>
<span class="line"><span style="color:#E1E4E8;">  propertyMapping: {</span></span>
<span class="line"><span style="color:#E1E4E8;">    x: </span><span style="color:#9ECBFF;">&#39;app-settings.x&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">...</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span>
<span class="line"><span style="color:#6A737D;">// Restore previous settings from local storage if any</span></span>
<span class="line"><span style="color:#E1E4E8;">settingsService.</span><span style="color:#B392F0;">restoreSettings</span><span style="color:#E1E4E8;">()</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { Store, LocalSettingsService } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;@kalisio/kdk/core.client&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Setup defaults in global store</span></span>
<span class="line"><span style="color:#24292E;">Store.</span><span style="color:#6F42C1;">set</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;app-settings&#39;</span><span style="color:#24292E;">, { x: y, </span><span style="color:#D73A49;">...</span><span style="color:#24292E;"> })</span></span>
<span class="line"><span style="color:#6A737D;">// Create a service targeting only settings in store</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">settingsService</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> api.</span><span style="color:#6F42C1;">createService</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;settings&#39;</span><span style="color:#24292E;">, {</span></span>
<span class="line"><span style="color:#24292E;">  service: LocalSettingsService,</span></span>
<span class="line"><span style="color:#24292E;">  propertyMapping: {</span></span>
<span class="line"><span style="color:#24292E;">    x: </span><span style="color:#032F62;">&#39;app-settings.x&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">...</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">})</span></span>
<span class="line"><span style="color:#6A737D;">// Restore previous settings from local storage if any</span></span>
<span class="line"><span style="color:#24292E;">settingsService.</span><span style="color:#6F42C1;">restoreSettings</span><span style="color:#24292E;">()</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Because settings are available through a service interface you can edit it using the <a href="./components.html#editors">editor system</a>. The <code>propertyMapping</code> will be used to match form field names and corresponding global store properties.</p></div><p>For instance the following schema can be used to edit the previous sample:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;$schema&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;http://json-schema.org/draft-07/schema#&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;$id&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;http://www.kalisio.xyz/schemas/settings.update.json#&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;title&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;schemas.UPDATE_SETTINGS_TITLE&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;type&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;object&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;properties&quot;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">&quot;x&quot;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">&quot;type&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;string&quot;</span><span style="color:#E1E4E8;">, </span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">&quot;field&quot;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">&quot;component&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;form/KTextField&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">&quot;helper&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;schemas.X_FIELD_LABEL&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;required&quot;</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;x&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;$schema&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;http://json-schema.org/draft-07/schema#&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;$id&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;http://www.kalisio.xyz/schemas/settings.update.json#&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;title&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;schemas.UPDATE_SETTINGS_TITLE&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;type&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;object&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;properties&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">&quot;x&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;type&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;string&quot;</span><span style="color:#24292E;">, </span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;field&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;component&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;form/KTextField&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;helper&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;schemas.X_FIELD_LABEL&quot;</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">  },</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;required&quot;</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;x&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div>`,9);function v(T,D,_,F,P,B){const o=c("Mermaid");return e(),i("div",null,[h,(e(),t(l,null,{default:s(()=>[n(o,{id:"mermaid-23",class:"eita",graph:"graph%20TB%0A%20%20beforeAll%7Bnone%20before%20all%7D%0A%20%20afterAll%7Bafter%20all%7D%0A%20%20afterAll%20--%3E%20hook1(%22discard('passwords')%22)%0A%20%20hook1%20--%20Email%2FName%20extracted%20from%20profile%20--%3E%20hook2(%22serialize('profile')%22)%0A%20%20beforeAll%20--%3E%20FIND%5BFIND%5D%0A%20%20FIND%20--%3E%20afterAll%0A%20%20beforeAll%20--%3E%20GET%5BGET%5D%0A%20%20GET%20--%3E%20afterAll%0A%20%20beforeAll%20--%3E%20hook3(%22serialize('OAuth2%20profile')%22)%0A%20%20hook3%20--%20Email%2FName%20extracted%20from%20provider%20--%3E%20hook4(%22serialize('profile')%22)%0A%20%20hook4%20--%20Email%2FName%20set%20in%20profile%20--%3E%20hook5(%22serialize('clearPassword')%22)%0A%20%20hook5%20--%20Clear%20password%20saved%20--%3E%20hook6(%22hashPassword%22)%0A%20%20hook6%20--%20Password%20hashed%20--%3E%20hook7(%22enforcePasswordPolicy%22)%0A%20%20hook7%20--%20Clear%20password%20validated%20--%3E%20hook8(%22discard('clearPassword')%22)%0A%20%20hook8%20--%20Clear%20password%20removed%20--%3E%20CREATE%5BCREATE%5D%0A%20%20CREATE%20--%3E%20hook9(updateAbilities)%0A%20%20hook9%20--%20Abilities%20initialized%20in%20cache%20--%3E%20afterAll%0A%20%20beforeAll%20--%3E%20hook10(populatePreviousObject)%0A%20%20hook10%20--%20Previous%20user%20as%20params%20--%3E%20hook11(storePreviousPassword)%0A%20%20hook11%20--%20Previous%20password%20list%20updated%20--%3E%20UPDATE%5BUPDATE%5D%0A%20%20UPDATE%20--%3E%20afterAll%0A%20%20beforeAll%20--%3E%20hook12(populatePreviousObject)%0A%20%20hook12%20--%20Previous%20user%20as%20params%20--%3E%20hook13(storePreviousPassword)%0A%20%20hook13%20--%20Previous%20password%20list%20updated%20--%3E%20PATCH%5BPATCH%5D%0A%20%20PATCH%20--%3E%20afterAll%0A%20%20beforeAll%20--%3E%20REMOVE%5BREMOVE%5D%0A%20%20REMOVE%20--%3E%20afterAll%0A%20%20linkStyle%20default%20stroke-width%3A2px%2Cfill%3Anone%2Cstroke%3Ablack%0A%20%20classDef%20hookClass%20fill%3A%23f96%2Cstroke%3A%23333%2Cstroke-width%3A2px%0A%20%20class%20hook1%2Chook2%2Chook3%2Chook4%2Chook5%2Chook6%2Chook7%2Chook8%2Chook9%2Chook10%2Chook11%2Chook12%2Chook13%20hookClass%0A%20%20classDef%20operationClass%20fill%3A%239c6%2Cstroke%3A%23333%2Cstroke-width%3A2px%0A%20%20class%20FIND%2CGET%2CCREATE%2CUPDATE%2CPATCH%2CREMOVE%20operationClass%0A"})]),fallback:s(()=>[r(" Loading... ")]),_:1})),d,(e(),t(l,null,{default:s(()=>[n(o,{id:"mermaid-57",class:"eita",graph:"graph%20TB%0A%20%20before%7Bnone%20before%20all%7D%0A%20%20after%7Bnone%20after%20all%7D%0A%20%20before%20--%3E%20UPDATE%5BUPDATE%5D%0A%20%20UPDATE%20--%20If%20new%20device%20--%3E%20CREATE%0A%20%20UPDATE%20--%20If%20existing%20device%20--%3E%20UPDATE_DEVICE%5B%5BUPDATE%20DEVICE%3Cbr%2F%3E-pusher%20service-%5D%5D%0A%20%20UPDATE_DEVICE%20--%3E%20after%0A%20%20before%20--%3E%20hook1(%22disallow('external')%22)%0A%20%20hook1%20--%3E%20CREATE%5BCREATE%5D%0A%20%20CREATE%20--%3E%20CREATE_DEVICE%5B%5BCREATE%20DEVICE%3Cbr%2F%3E-pusher%20service-%5D%5D%0A%20%20CREATE_DEVICE%20--%3E%20PATCH_USER%5B%5BPATCH%20USER%3Cbr%2F%3E-users%20service-%5D%5D%0A%20%20PATCH_USER%20--%3E%20after%0A%20%20before%20--%3E%20REMOVE%5BREMOVE%5D%0A%20%20REMOVE%20--%3E%20REMOVE_DEVICE%5B%5BREMOVE%20DEVICE%3Cbr%2F%3E-pusher%20service-%5D%5D%0A%20%20REMOVE_DEVICE%20--%3E%20%20PATCH_USER%5B%5BPATCH%20USER%3Cbr%2F%3E-users%20service-%5D%5D%0A%20%20PATCH_USER%20--%3E%20after%0A%20%20linkStyle%20default%20stroke-width%3A2px%2Cfill%3Anone%2Cstroke%3Ablack%0A%20%20classDef%20hookClass%20fill%3A%23f96%2Cstroke%3A%23333%2Cstroke-width%3A2px%0A%20%20class%20hook1%2Chook2%2Chook3%2Chook4%20hookClass%0A%20%20classDef%20operationClass%20fill%3A%239c6%2Cstroke%3A%23333%2Cstroke-width%3A2px%0A%20%20class%20FIND%2CGET%2CCREATE%2CUPDATE%2CPATCH%2CREMOVE%2CCREATE_DEVICE%2CREMOVE_DEVICE%2CUPDATE_DEVICE%2CPATCH_USER%20operationClass%0A"})]),fallback:s(()=>[r(" Loading... ")]),_:1})),u,(e(),t(l,null,{default:s(()=>[n(o,{id:"mermaid-88",class:"eita",graph:"graph%20TB%0A%20%20before%7B%22disallow('external')%22%7D%0A%20%20after%7Bnone%20after%20all%7D%0A%20%20before%20--%3E%20CREATE%5BCREATE%5D%0A%20%20CREATE%20--%3E%20after%0A%20%20linkStyle%20default%20stroke-width%3A2px%2Cfill%3Anone%2Cstroke%3Ablack%0A%20%20classDef%20hookClass%20fill%3A%23f96%2Cstroke%3A%23333%2Cstroke-width%3A2px%0A%20%20class%20hook1%2Chook2%2Chook3%2Chook4%20hookClass%0A%20%20classDef%20operationClass%20fill%3A%239c6%2Cstroke%3A%23333%2Cstroke-width%3A2px%0A%20%20class%20FIND%2CCREATE%2CREMOVE%20operationClass%0A"})]),fallback:s(()=>[r(" Loading... ")]),_:1})),A,(e(),t(l,null,{default:s(()=>[n(o,{id:"mermaid-218",class:"eita",graph:"graph%20TB%0A%20%20before%7B%22disallow('external')%22%7D%0A%20%20after%7Bnone%20after%20all%7D%0A%20%20before%20--%20Resource%20as%20data%2Fparams%20--%3E%20hook1(populatePushObject)%0A%20%20hook1%20--%20Resource%20as%20params%20--%3E%20CREATE%5BCREATE%5D%0A%20%20CREATE%20--%20If%20user%20device%20--%3E%20CREATE_ENDPOINT%5BCREATE%20ENDPOINT%5D%0A%20%20CREATE%20--%20If%20resource%20topic%20--%3E%20CREATE_TOPIC%5BCREATE%20TOPIC%5D%0A%20%20CREATE%20--%20If%20subscriptions%20--%3E%20SUBSCRIBE%5BSUBSCRIBE%5D%0A%20%20CREATE%20--%20If%20message%3Cbr%2F%3E-device%20or%20topic-%20--%3E%20PUBLISH%5BPUBLISH%5D%0A%20%20CREATE_ENDPOINT%20--%3E%20after%0A%20%20CREATE_TOPIC%20--%3E%20PATCH%5B%5BPATCH%20RESOURCE%3Cbr%2F%3E-resource%20service-%5D%5D%0A%20%20PATCH%20--%3E%20after%0A%20%20SUBSCRIBE%20--%3E%20after%0A%20%20PUBLISH%20--%3E%20after%0A%20%20before%20--%20Resource%20id%20as%20query%2Fparams%20--%3E%20hook2(populatePushObject)%0A%20%20hook2%20--%20Resource%20as%20params%20--%3E%20REMOVE%5BREMOVE%5D%0A%20%20REMOVE%20--%20If%20user%20device%20--%3E%20REMOVE_ENDPOINT%5BREMOVE%20ENDPOINT%5D%0A%20%20REMOVE%20--%20If%20resource%20topic%20--%3E%20REMOVE_TOPIC%5BREMOVE%20TOPIC%5D%0A%20%20REMOVE%20--%20If%20subscriptions%20--%3E%20UNSUBSCRIBE%5BUNSUBSCRIBE%5D%0A%20%20REMOVE_ENDPOINT%20--%3E%20after%0A%20%20REMOVE_TOPIC%20--%3E%20PATCH%5B%5BPATCH%20RESOURCE%3Cbr%2F%3E-resource%20service-%5D%5D%0A%20%20PATCH%20--%3E%20after%0A%20%20UNSUBSCRIBE%20--%3E%20after%0A%20%20before%20--%3E%20UPDATE%5BUPDATE%5D%0A%20%20UPDATE%20--%20If%20device%20--%3E%20UPDATE_ENDPOINT%5BUPDATE%20ENDPOINT%5D%0A%20%20UPDATE_ENDPOINT%20--%3E%20after%0A%20%20linkStyle%20default%20stroke-width%3A2px%2Cfill%3Anone%2Cstroke%3Ablack%0A%20%20classDef%20hookClass%20fill%3A%23f96%2Cstroke%3A%23333%2Cstroke-width%3A2px%0A%20%20class%20hook1%2Chook2%2Chook3%2Chook4%20hookClass%0A%20%20classDef%20operationClass%20fill%3A%239c6%2Cstroke%3A%23333%2Cstroke-width%3A2px%0A%20%20class%20FIND%2CGET%2CCREATE%2CUPDATE%2CPATCH%2CREMOVE%20operationClass%0A%20%20classDef%20snsOperationClass%20fill%3A%2363c5da%2Cstroke%3A%23333%2Cstroke-width%3A2px%0A%20%20class%20CREATE_ENDPOINT%2CCREATE_TOPIC%2CSUBSCRIBE%2CPUBLISH%2CREMOVE_ENDPOINT%2CREMOVE_TOPIC%2CUNSUBSCRIBE%2CUPDATE_ENDPOINT%20snsOperationClass%0A"})]),fallback:s(()=>[r(" Loading... ")]),_:1})),m,(e(),t(l,null,{default:s(()=>[n(o,{id:"mermaid-242",class:"eita",graph:"graph%20TB%0A%20%20before%7Bnone%20before%20all%7D%0A%20%20after%7Bnone%20after%20all%7D%0A%20%20before%20--%20If%20reset%2Fchange%20password%20--%3E%20hook1(populateAccountUser)%0A%20%20hook1%20--%3E%20hook2(enforcePasswordPolicy)%0A%20%20hook2%20--%3E%20CREATE%5BCREATE%5D%0A%20%20CREATE%20--%3E%20after%0A%20%20linkStyle%20default%20stroke-width%3A2px%2Cfill%3Anone%2Cstroke%3Ablack%0A%20%20classDef%20hookClass%20fill%3A%23f96%2Cstroke%3A%23333%2Cstroke-width%3A2px%0A%20%20class%20hook1%2Chook2%2Chook3%2Chook4%20hookClass%0A%20%20classDef%20operationClass%20fill%3A%239c6%2Cstroke%3A%23333%2Cstroke-width%3A2px%0A%20%20class%20FIND%2CGET%2CCREATE%2CUPDATE%2CPATCH%2CREMOVE%20operationClass%0A"})]),fallback:s(()=>[r(" Loading... ")]),_:1})),f,(e(),t(l,null,{default:s(()=>[n(o,{id:"mermaid-309",class:"eita",graph:"graph%20TB%0A%20%20before%7Bnone%20before%20all%7D%0A%20%20after%7Bnone%20after%20all%7D%0A%20%20before%20--%20Subject%20service%20as%20data%2Fparams%3Cbr%2F%3EResource%20as%20data%2Fparams%20--%3E%20hook1(populateSubjects)%0A%20%20hook1%20--%20Authorisation%20subjects%20as%20params%20--%3E%20hook2(populateResource)%0A%20%20hook2%20--%20Authorisation%20resource%20as%20params%20--%3E%20CREATE%5BCREATE%5D%0A%20%20CREATE%20--%3E%20PATCH%5B%5BPATCH%20SUBJECT%3Cbr%2F%3E-subject%20service-%5D%5D%0A%20%20PATCH%20--%3E%20after%0A%20%20before%20--%20Subject%20service%20as%20query%2Fparams%3Cbr%2F%3EResource%20id%20as%20query%2Fparams%20--%3E%20hook3(populateSubjects)%0A%20%20hook3%20--%20Authorisation%20subjects%20as%20params%20--%3E%20hook4(populateResource)%0A%20%20hook4%20--%20Authorisation%20resource%20as%20params%20--%3E%20REMOVE%5BREMOVE%5D%0A%20%20REMOVE%20--%3E%20PATCH%5B%5BPATCH%20SUBJECT%3Cbr%2F%3E-subject%20service-%5D%5D%0A%20%20PATCH%20--%3E%20after%0A%20%20linkStyle%20default%20stroke-width%3A2px%2Cfill%3Anone%2Cstroke%3Ablack%0A%20%20classDef%20hookClass%20fill%3A%23f96%2Cstroke%3A%23333%2Cstroke-width%3A2px%0A%20%20class%20hook1%2Chook2%2Chook3%2Chook4%20hookClass%0A%20%20classDef%20operationClass%20fill%3A%239c6%2Cstroke%3A%23333%2Cstroke-width%3A2px%0A%20%20class%20FIND%2CGET%2CCREATE%2CUPDATE%2CPATCH%2CREMOVE%20operationClass%0A"})]),fallback:s(()=>[r(" Loading... ")]),_:1})),y,(e(),t(l,null,{default:s(()=>[n(o,{id:"mermaid-341",class:"eita",graph:"graph%20TB%0A%20%20before%7Bnone%20before%20all%7D%0A%20%20after%7Bnone%20after%20all%7D%0A%20%20before%20--%3E%20FIND%5BFIND%5D%0A%20%20FIND%20--%3E%20after%0A%20%20before%20--%3E%20GET%5BGET%5D%0A%20%20GET%20--%3E%20after%0A%20%20before%20--%20Optional%20resource%20as%20data%2Fparams%20--%3E%20hook2(populateTagResource)%0A%20%20hook2%20--%20Tag%20resource%20as%20params%20--%3E%20hook3(addTagIfNew)%0A%20%20hook3%20--%20Created%20or%20patched%20tag%3Cbr%2F%3Eby%20recursive%20call%20--%3E%20CREATE%5BCREATE%5D%0A%20%20CREATE%20--%3E%20hook4(tagResource)%0A%20%20hook4%20--%20Updated%20resource%20--%3E%20after%0A%20%20before%20--%3E%20UPDATE%5BUPDATE%5D%0A%20%20UPDATE%20--%3E%20hook5(%22updateOrgResource('tags')%22)%0A%20%20hook5%20--%20Updated%20tagged%20members%20--%3E%20after%0A%20%20before%20--%3E%20PATCH%5BPATCH%5D%0A%20%20PATCH%20--%3E%20hook6(%22updateOrgResource('tags')%22)%0A%20%20hook6%20--%20Updated%20tagged%20members%20--%3E%20after%0A%20%20before%20--%20Optional%20resource%20as%20query%2Fparams%20--%3E%20hook7(populateTagResource)%0A%20%20hook7%20--%20Tag%20resource%20as%20params%20--%3E%20hook8(removeTagIfUnused)%0A%20%20hook8%20--%20Removed%20or%20patched%20tag%3Cbr%2F%3Eby%20recursive%20call%20--%3E%20REMOVE%5BREMOVE%5D%0A%20%20REMOVE%20--%3E%20hook9(untagResource)%0A%20%20hook9%20--%20Updated%20resource%20--%3E%20after%0A%20%20linkStyle%20default%20stroke-width%3A2px%2Cfill%3Anone%2Cstroke%3Ablack%0A%20%20classDef%20hookClass%20fill%3A%23f96%2Cstroke%3A%23333%2Cstroke-width%3A2px%0A%20%20class%20hook1%2Chook2%2Chook3%2Chook4%2Chook5%2Chook6%2Chook7%2Chook8%2Chook9%20hookClass%0A%20%20classDef%20operationClass%20fill%3A%239c6%2Cstroke%3A%23333%2Cstroke-width%3A2px%0A%20%20class%20FIND%2CGET%2CCREATE%2CUPDATE%2CPATCH%2CREMOVE%20operationClass%0A"})]),fallback:s(()=>[r(" Loading... ")]),_:1})),k,(e(),t(l,null,{default:s(()=>[n(o,{id:"mermaid-373",class:"eita",graph:"graph%20TB%0A%20%20before%7Bnone%20before%20all%7D%0A%20%20after%7Bnone%20after%20all%7D%0A%20%20before%20--%3E%20hook1(disallow)%0A%20%20hook1%20--%3E%20FIND%5BFIND%5D%0A%20%20FIND%20--%3E%20after%0A%20%20before%20--%3E%20GET%5BGET%5D%0A%20%20GET%20--%3E%20after%0A%20%20before%20--%20Optional%20resource%20as%20data%2Fparams%20--%3E%20hook2(populateAttachmentResource)%0A%20%20hook2%20--%20Attachment%20resource%20as%20params%20--%3E%20CREATE%5BCREATE%5D%0A%20%20CREATE%20--%20Blob%20created%20--%3E%20hook3(attachToResource)%0A%20%20hook3%20--%20Updated%20resource%20--%3E%20hook4(%22discard('uri')%22)%0A%20%20hook4%20--%3E%20after%0A%20%20before%20--%3E%20hook5(disallow)%0A%20%20hook5%20--%3E%20UPDATE%5BUPDATE%5D%0A%20%20UPDATE%20--%3E%20after%0A%20%20before%20--%3E%20hook6(disallow)%0A%20%20hook6%20--%3E%20PATCH%5BPATCH%5D%0A%20%20PATCH%20--%3E%20after%0A%20%20before%20--%20Optional%20resource%20as%20query%2Fparams%20--%3E%20hook7(populateAttachmentResource)%0A%20%20hook7%20--%20Attachment%20resource%20as%20params%20--%3E%20REMOVE%5BREMOVE%5D%0A%20%20REMOVE%20--%20Blob%20removed%20--%3E%20hook8(detachFromResource)%0A%20%20hook8%20--%20Updated%20resource%20--%3E%20hook9(%22discard('uri')%22)%0A%20%20hook9%20--%3E%20after%0A%20%20linkStyle%20default%20stroke-width%3A2px%2Cfill%3Anone%2Cstroke%3Ablack%0A%20%20classDef%20hookClass%20fill%3A%23f96%2Cstroke%3A%23333%2Cstroke-width%3A2px%0A%20%20class%20hook1%2Chook2%2Chook3%2Chook4%2Chook5%2Chook6%2Chook7%2Chook8%2Chook9%20hookClass%0A%20%20classDef%20operationClass%20fill%3A%239c6%2Cstroke%3A%23333%2Cstroke-width%3A2px%0A%20%20class%20FIND%2CGET%2CCREATE%2CUPDATE%2CPATCH%2CREMOVE%20operationClass%0A"})]),fallback:s(()=>[r(" Loading... ")]),_:1})),C,(e(),t(l,null,{default:s(()=>[n(o,{id:"mermaid-396",class:"eita",graph:"graph%20TB%0A%20%20before%7B%22disallow('external')%22%7D%0A%20%20after%7Bnone%20after%20all%7D%0A%20%20before%20--%3E%20FIND%5BFIND%5D%0A%20%20FIND%20--%3E%20after%0A%20%20before%20--%3E%20CREATE%5BCREATE%5D%0A%20%20CREATE%20--%3E%20after%0A%20%20before%20--%3E%20REMOVE%5BREMOVE%5D%0A%20%20REMOVE%20--%3E%20after%0A%20%20linkStyle%20default%20stroke-width%3A2px%2Cfill%3Anone%2Cstroke%3Ablack%0A%20%20classDef%20hookClass%20fill%3A%23f96%2Cstroke%3A%23333%2Cstroke-width%3A2px%0A%20%20class%20hook1%2Chook2%2Chook3%2Chook4%20hookClass%0A%20%20classDef%20operationClass%20fill%3A%239c6%2Cstroke%3A%23333%2Cstroke-width%3A2px%0A%20%20class%20FIND%2CCREATE%2CREMOVE%20operationClass%0A"})]),fallback:s(()=>[r(" Loading... ")]),_:1})),g,(e(),t(l,null,{default:s(()=>[n(o,{id:"mermaid-494",class:"eita",graph:"graph%20TB%0A%20%20before%7Bnone%20before%20all%7D%0A%20%20after%7Bnone%20after%20all%7D%0A%20%20before%20--%3E%20FIND%5BFIND%5D%0A%20%20FIND%20--%3E%20after%0A%20%20before%20--%3E%20GET%5BGET%5D%0A%20%20GET%20--%3E%20after%0A%20%20before%20--%3E%20CREATE%5BCREATE%5D%0A%20%20CREATE%20--%3E%20after%0A%20%20before%20--%3E%20UPDATE%5BUPDATE%5D%0A%20%20UPDATE%20--%3E%20hook1(%22updateOrgResource('groups')%22)%0A%20%20hook1%20--%20Updated%20authorization%3Cbr%2F%3Escopes%20on%20members%20--%3E%20after%0A%20%20before%20--%3E%20PATCH%5BPATCH%5D%0A%20%20PATCH%20--%3E%20hook2(%22updateOrgResource('groups')%22)%0A%20%20hook2%20--%20Updated%20authorization%3Cbr%2F%3Escopes%20on%20members%20--%3E%20after%0A%20%20before%20--%3E%20REMOVE%5BREMOVE%5D%0A%20%20REMOVE%20--%3E%20after%0A%20%20linkStyle%20default%20stroke-width%3A2px%2Cfill%3Anone%2Cstroke%3Ablack%0A%20%20classDef%20hookClass%20fill%3A%23f96%2Cstroke%3A%23333%2Cstroke-width%3A2px%0A%20%20class%20hook1%2Chook2%2Chook3%2Chook4%2Chook5%2Chook6%2Chook7%2Chook8%2Chook9%20hookClass%0A%20%20classDef%20operationClass%20fill%3A%239c6%2Cstroke%3A%23333%2Cstroke-width%3A2px%0A%20%20class%20FIND%2CGET%2CCREATE%2CUPDATE%2CPATCH%2CREMOVE%20operationClass%0A"})]),fallback:s(()=>[r(" Loading... ")]),_:1})),b])}const q=p(E,[["render",v]]);export{w as __pageData,q as default};
