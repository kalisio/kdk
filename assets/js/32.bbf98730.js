(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{536:function(e,t,s){"use strict";s.r(t);var a=s(13),o=function(e){e.options.__data__block__={mermaid_382ee167:'graph TB\n  beforeAll{none before all}\n  afterAll{after all}\n  afterAll --\x3e hook1("discard(\'passwords\')")\n  hook1 -- Email/Name extracted from profile --\x3e hook2("serialize(\'profile\')")\n  beforeAll --\x3e FIND[FIND]\n  FIND --\x3e afterAll\n  beforeAll --\x3e GET[GET]\n  GET --\x3e afterAll\n  beforeAll --\x3e hook3("serialize(\'OAuth2 profile\')")\n  hook3 -- Email/Name extracted from provider --\x3e hook4("serialize(\'profile\')")\n  hook4 -- Email/Name set in profile --\x3e hook5("serialize(\'clearPassword\')")\n  hook5 -- Clear password saved --\x3e hook6("hashPassword")\n  hook6 -- Password hashed --\x3e hook7("enforcePasswordPolicy")\n  hook7 -- Clear password validated --\x3e hook8("discard(\'clearPassword\')")\n  hook8 -- Clear password removed --\x3e CREATE[CREATE]\n  CREATE --\x3e hook9(updateAbilities)\n  hook9 -- Abilities initialized in cache --\x3e afterAll\n  beforeAll --\x3e hook10(populatePreviousObject)\n  hook10 -- Previous user as params --\x3e hook11(storePreviousPassword)\n  hook11 -- Previous password list updated --\x3e UPDATE[UPDATE]\n  UPDATE --\x3e afterAll\n  beforeAll --\x3e hook12(populatePreviousObject)\n  hook12 -- Previous user as params --\x3e hook13(storePreviousPassword)\n  hook13 -- Previous password list updated --\x3e PATCH[PATCH]\n  PATCH --\x3e afterAll\n  beforeAll --\x3e REMOVE[REMOVE]\n  REMOVE --\x3e afterAll\n  linkStyle default stroke-width:2px,fill:none,stroke:black\n  classDef hookClass fill:#f96,stroke:#333,stroke-width:2px\n  class hook1,hook2,hook3,hook4,hook5,hook6,hook7,hook8,hook9,hook10,hook11,hook12,hook13 hookClass\n  classDef operationClass fill:#9c6,stroke:#333,stroke-width:2px\n  class FIND,GET,CREATE,UPDATE,PATCH,REMOVE operationClass',mermaid_382ee1c8:"graph TB\n  before{none before all}\n  after{none after all}\n  before --\x3e UPDATE[UPDATE]\n  UPDATE -- If new device --\x3e CREATE\n  UPDATE -- If existing device --\x3e UPDATE_DEVICE[[UPDATE DEVICE<br/>-pusher service-]]\n  UPDATE_DEVICE --\x3e after\n  before --\x3e hook1(\"disallow('external')\")\n  hook1 --\x3e CREATE[CREATE]\n  CREATE --\x3e CREATE_DEVICE[[CREATE DEVICE<br/>-pusher service-]]\n  CREATE_DEVICE --\x3e PATCH_USER[[PATCH USER<br/>-users service-]]\n  PATCH_USER --\x3e after\n  before --\x3e REMOVE[REMOVE]\n  REMOVE --\x3e REMOVE_DEVICE[[REMOVE DEVICE<br/>-pusher service-]]\n  REMOVE_DEVICE --\x3e  PATCH_USER[[PATCH USER<br/>-users service-]]\n  PATCH_USER --\x3e after\n  linkStyle default stroke-width:2px,fill:none,stroke:black\n  classDef hookClass fill:#f96,stroke:#333,stroke-width:2px\n  class hook1,hook2,hook3,hook4 hookClass\n  classDef operationClass fill:#9c6,stroke:#333,stroke-width:2px\n  class FIND,GET,CREATE,UPDATE,PATCH,REMOVE,CREATE_DEVICE,REMOVE_DEVICE,UPDATE_DEVICE,PATCH_USER operationClass",mermaid_382ee226:"graph TB\n  before{\"disallow('external')\"}\n  after{none after all}\n  before --\x3e CREATE[CREATE]\n  CREATE --\x3e after\n  linkStyle default stroke-width:2px,fill:none,stroke:black\n  classDef hookClass fill:#f96,stroke:#333,stroke-width:2px\n  class hook1,hook2,hook3,hook4 hookClass\n  classDef operationClass fill:#9c6,stroke:#333,stroke-width:2px\n  class FIND,CREATE,REMOVE operationClass",mermaid_64a5691a:"graph TB\n  before{\"disallow('external')\"}\n  after{none after all}\n  before -- Resource as data/params --\x3e hook1(populatePushObject)\n  hook1 -- Resource as params --\x3e CREATE[CREATE]\n  CREATE -- If user device --\x3e CREATE_ENDPOINT[CREATE ENDPOINT]\n  CREATE -- If resource topic --\x3e CREATE_TOPIC[CREATE TOPIC]\n  CREATE -- If subscriptions --\x3e SUBSCRIBE[SUBSCRIBE]\n  CREATE -- If message<br/>-device or topic- --\x3e PUBLISH[PUBLISH]\n  CREATE_ENDPOINT --\x3e after\n  CREATE_TOPIC --\x3e PATCH[[PATCH RESOURCE<br/>-resource service-]]\n  PATCH --\x3e after\n  SUBSCRIBE --\x3e after\n  PUBLISH --\x3e after\n  before -- Resource id as query/params --\x3e hook2(populatePushObject)\n  hook2 -- Resource as params --\x3e REMOVE[REMOVE]\n  REMOVE -- If user device --\x3e REMOVE_ENDPOINT[REMOVE ENDPOINT]\n  REMOVE -- If resource topic --\x3e REMOVE_TOPIC[REMOVE TOPIC]\n  REMOVE -- If subscriptions --\x3e UNSUBSCRIBE[UNSUBSCRIBE]\n  REMOVE_ENDPOINT --\x3e after\n  REMOVE_TOPIC --\x3e PATCH[[PATCH RESOURCE<br/>-resource service-]]\n  PATCH --\x3e after\n  UNSUBSCRIBE --\x3e after\n  before --\x3e UPDATE[UPDATE]\n  UPDATE -- If device --\x3e UPDATE_ENDPOINT[UPDATE ENDPOINT]\n  UPDATE_ENDPOINT --\x3e after\n  linkStyle default stroke-width:2px,fill:none,stroke:black\n  classDef hookClass fill:#f96,stroke:#333,stroke-width:2px\n  class hook1,hook2,hook3,hook4 hookClass\n  classDef operationClass fill:#9c6,stroke:#333,stroke-width:2px\n  class FIND,GET,CREATE,UPDATE,PATCH,REMOVE operationClass\n  classDef snsOperationClass fill:#63c5da,stroke:#333,stroke-width:2px\n  class CREATE_ENDPOINT,CREATE_TOPIC,SUBSCRIBE,PUBLISH,REMOVE_ENDPOINT,REMOVE_TOPIC,UNSUBSCRIBE,UPDATE_ENDPOINT snsOperationClass",mermaid_64a5686c:"graph TB\n  before{none before all}\n  after{none after all}\n  before -- If reset/change password --\x3e hook1(populateAccountUser)\n  hook1 --\x3e hook2(enforcePasswordPolicy)\n  hook2 --\x3e CREATE[CREATE]\n  CREATE --\x3e after\n  linkStyle default stroke-width:2px,fill:none,stroke:black\n  classDef hookClass fill:#f96,stroke:#333,stroke-width:2px\n  class hook1,hook2,hook3,hook4 hookClass\n  classDef operationClass fill:#9c6,stroke:#333,stroke-width:2px\n  class FIND,GET,CREATE,UPDATE,PATCH,REMOVE operationClass",mermaid_64a561d4:"graph TB\n  before{none before all}\n  after{none after all}\n  before -- Subject service as data/params<br/>Resource as data/params --\x3e hook1(populateSubjects)\n  hook1 -- Authorisation subjects as params --\x3e hook2(populateResource)\n  hook2 -- Authorisation resource as params --\x3e CREATE[CREATE]\n  CREATE --\x3e PATCH[[PATCH SUBJECT<br/>-subject service-]]\n  PATCH --\x3e after\n  before -- Subject service as query/params<br/>Resource id as query/params --\x3e hook3(populateSubjects)\n  hook3 -- Authorisation subjects as params --\x3e hook4(populateResource)\n  hook4 -- Authorisation resource as params --\x3e REMOVE[REMOVE]\n  REMOVE --\x3e PATCH[[PATCH SUBJECT<br/>-subject service-]]\n  PATCH --\x3e after\n  linkStyle default stroke-width:2px,fill:none,stroke:black\n  classDef hookClass fill:#f96,stroke:#333,stroke-width:2px\n  class hook1,hook2,hook3,hook4 hookClass\n  classDef operationClass fill:#9c6,stroke:#333,stroke-width:2px\n  class FIND,GET,CREATE,UPDATE,PATCH,REMOVE operationClass",mermaid_64a560ec:"graph TB\n  before{none before all}\n  after{none after all}\n  before --\x3e FIND[FIND]\n  FIND --\x3e after\n  before --\x3e GET[GET]\n  GET --\x3e after\n  before -- Optional resource as data/params --\x3e hook2(populateTagResource)\n  hook2 -- Tag resource as params --\x3e hook3(addTagIfNew)\n  hook3 -- Created or patched tag<br/>by recursive call --\x3e CREATE[CREATE]\n  CREATE --\x3e hook4(tagResource)\n  hook4 -- Updated resource --\x3e after\n  before --\x3e UPDATE[UPDATE]\n  UPDATE --\x3e hook5(\"updateOrgResource('tags')\")\n  hook5 -- Updated tagged members --\x3e after\n  before --\x3e PATCH[PATCH]\n  PATCH --\x3e hook6(\"updateOrgResource('tags')\")\n  hook6 -- Updated tagged members --\x3e after\n  before -- Optional resource as query/params --\x3e hook7(populateTagResource)\n  hook7 -- Tag resource as params --\x3e hook8(removeTagIfUnused)\n  hook8 -- Removed or patched tag<br/>by recursive call --\x3e REMOVE[REMOVE]\n  REMOVE --\x3e hook9(untagResource)\n  hook9 -- Updated resource --\x3e after\n  linkStyle default stroke-width:2px,fill:none,stroke:black\n  classDef hookClass fill:#f96,stroke:#333,stroke-width:2px\n  class hook1,hook2,hook3,hook4,hook5,hook6,hook7,hook8,hook9 hookClass\n  classDef operationClass fill:#9c6,stroke:#333,stroke-width:2px\n  class FIND,GET,CREATE,UPDATE,PATCH,REMOVE operationClass",mermaid_64a5602e:"graph TB\n  before{none before all}\n  after{none after all}\n  before --\x3e hook1(disallow)\n  hook1 --\x3e FIND[FIND]\n  FIND --\x3e after\n  before --\x3e GET[GET]\n  GET --\x3e after\n  before -- Optional resource as data/params --\x3e hook2(populateAttachmentResource)\n  hook2 -- Attachment resource as params --\x3e CREATE[CREATE]\n  CREATE -- Blob created --\x3e hook3(attachToResource)\n  hook3 -- Updated resource --\x3e hook4(\"discard('uri')\")\n  hook4 --\x3e after\n  before --\x3e hook5(disallow)\n  hook5 --\x3e UPDATE[UPDATE]\n  UPDATE --\x3e after\n  before --\x3e hook6(disallow)\n  hook6 --\x3e PATCH[PATCH]\n  PATCH --\x3e after\n  before -- Optional resource as query/params --\x3e hook7(populateAttachmentResource)\n  hook7 -- Attachment resource as params --\x3e REMOVE[REMOVE]\n  REMOVE -- Blob removed --\x3e hook8(detachFromResource)\n  hook8 -- Updated resource --\x3e hook9(\"discard('uri')\")\n  hook9 --\x3e after\n  linkStyle default stroke-width:2px,fill:none,stroke:black\n  classDef hookClass fill:#f96,stroke:#333,stroke-width:2px\n  class hook1,hook2,hook3,hook4,hook5,hook6,hook7,hook8,hook9 hookClass\n  classDef operationClass fill:#9c6,stroke:#333,stroke-width:2px\n  class FIND,GET,CREATE,UPDATE,PATCH,REMOVE operationClass",mermaid_64a55fac:"graph TB\n  before{\"disallow('external')\"}\n  after{none after all}\n  before --\x3e FIND[FIND]\n  FIND --\x3e after\n  before --\x3e CREATE[CREATE]\n  CREATE --\x3e after\n  before --\x3e REMOVE[REMOVE]\n  REMOVE --\x3e after\n  linkStyle default stroke-width:2px,fill:none,stroke:black\n  classDef hookClass fill:#f96,stroke:#333,stroke-width:2px\n  class hook1,hook2,hook3,hook4 hookClass\n  classDef operationClass fill:#9c6,stroke:#333,stroke-width:2px\n  class FIND,CREATE,REMOVE operationClass",mermaid_64a5582e:"graph TB\n  before{none before all}\n  after{none after all}\n  before --\x3e FIND[FIND]\n  FIND --\x3e after\n  before --\x3e GET[GET]\n  GET --\x3e after\n  before --\x3e CREATE[CREATE]\n  CREATE --\x3e after\n  before --\x3e UPDATE[UPDATE]\n  UPDATE --\x3e hook1(\"updateOrgResource('groups')\")\n  hook1 -- Updated authorization<br/>scopes on members --\x3e after\n  before --\x3e PATCH[PATCH]\n  PATCH --\x3e hook2(\"updateOrgResource('groups')\")\n  hook2 -- Updated authorization<br/>scopes on members --\x3e after\n  before --\x3e REMOVE[REMOVE]\n  REMOVE --\x3e after\n  linkStyle default stroke-width:2px,fill:none,stroke:black\n  classDef hookClass fill:#f96,stroke:#333,stroke-width:2px\n  class hook1,hook2,hook3,hook4,hook5,hook6,hook7,hook8,hook9 hookClass\n  classDef operationClass fill:#9c6,stroke:#333,stroke-width:2px\n  class FIND,GET,CREATE,UPDATE,PATCH,REMOVE operationClass"}},r=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"services"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#services"}},[e._v("#")]),e._v(" Services")]),e._v(" "),s("h2",{attrs:{id:"users-service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#users-service"}},[e._v("#")]),e._v(" Users service")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("Available as a global service")])]),e._v(" "),s("h3",{attrs:{id:"data-model"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#data-model"}},[e._v("#")]),e._v(" Data model")]),e._v(" "),s("p",[e._v("The data model of a user as used by the API is "),s("RouterLink",{attrs:{to:"/architecture/data-model-view.html#user-data-model"}},[e._v("detailed here")]),e._v(".")],1),e._v(" "),s("h3",{attrs:{id:"hooks"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hooks"}},[e._v("#")]),e._v(" Hooks")]),e._v(" "),s("p",[e._v("The following "),s("RouterLink",{attrs:{to:"/api/core/hooks.html"}},[e._v("hooks")]),e._v(" are executed on the "),s("code",[e._v("users")]),e._v(" service:")],1),e._v(" "),s("Mermaid",{attrs:{id:"mermaid_382ee167",graph:e.$dataBlock.mermaid_382ee167}}),s("h2",{attrs:{id:"devices-service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#devices-service"}},[e._v("#")]),e._v(" Devices service")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("Available as a global service")])]),e._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),s("p",[s("code",[e._v("update")]),e._v(" and "),s("code",[e._v("remove")]),e._v(" methods are the only ones allowed from the client side\n"),s("code",[e._v("create")]),e._v(" method is only allowed from the server side")])]),e._v(" "),s("p",[s("code",[e._v("create")]),e._v(" (respectively "),s("code",[e._v("remove")]),e._v(") creates (respectively removes) the device to/from the notification system (APNS or Firebase).\n"),s("code",[e._v("update")]),e._v(" updates the device registration ID or create it if not yet created.")]),e._v(" "),s("h3",{attrs:{id:"data-model-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#data-model-2"}},[e._v("#")]),e._v(" Data model")]),e._v(" "),s("p",[e._v("The data model of a device as used by the API is "),s("RouterLink",{attrs:{to:"/architecture/data-model-view.html#device-data-model"}},[e._v("detailed here")]),e._v(".")],1),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("Devices are store in the "),s("code",[e._v("devices")]),e._v(" property of the user they belong to.")])]),e._v(" "),s("h3",{attrs:{id:"hooks-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hooks-2"}},[e._v("#")]),e._v(" Hooks")]),e._v(" "),s("p",[e._v("The following "),s("RouterLink",{attrs:{to:"/api/core/hooks.html"}},[e._v("hooks")]),e._v(" are executed on the "),s("code",[e._v("devices")]),e._v(" service:")],1),e._v(" "),s("Mermaid",{attrs:{id:"mermaid_382ee1c8",graph:e.$dataBlock.mermaid_382ee1c8}}),s("h2",{attrs:{id:"mailer-service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mailer-service"}},[e._v("#")]),e._v(" Mailer service")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("Available as a global service")])]),e._v(" "),s("p",[e._v("This service is powered by "),s("a",{attrs:{href:"https://github.com/feathersjs-ecosystem/feathers-mailer",target:"_blank",rel:"noopener noreferrer"}},[e._v("feathers-mailer"),s("OutboundLink")],1),e._v(". It acts as a proxy to send emails through an SMTP server.")]),e._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),s("p",[e._v("Service methods are only allowed from the server side. "),s("code",[e._v("create")]),e._v(" is the sole available method used to send an email.")])]),e._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[e._v("DEPRECATION NOTICE")]),e._v(" "),s("p",[e._v("The email account can authorise connection by email/password on "),s("a",{attrs:{href:"https://myaccount.google.com/lesssecureapps",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://myaccount.google.com/lesssecureapps"),s("OutboundLink")],1),e._v(". Before that the domain admin should allow him to manage this setting ("),s("em",[e._v("Admin Console > Security > General > Less secure apps settings")]),e._v("). To avoid changing it for all users first create a group, add the user to the group and let the group manage less secure apps setting.")])]),e._v(" "),s("p",[e._v("On 15 february 2021 Gmail API requires OAuth2 authentication to send emails. The simplest solution is to create a "),s("a",{attrs:{href:"https://medium.com/@imre_7961/nodemailer-with-g-suite-oauth2-4c86049f778a",target:"_blank",rel:"noopener noreferrer"}},[e._v("service account"),s("OutboundLink")],1),e._v(" and to "),s("a",{attrs:{href:"https://developers.google.com/identity/protocols/oauth2/service-account",target:"_blank",rel:"noopener noreferrer"}},[e._v("delegate the domain-wide authority to the service account"),s("OutboundLink")],1),e._v(" with scope "),s("code",[e._v("https://mail.google.com")]),e._v(".")]),e._v(" "),s("h3",{attrs:{id:"hooks-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hooks-3"}},[e._v("#")]),e._v(" Hooks")]),e._v(" "),s("p",[e._v("The following "),s("RouterLink",{attrs:{to:"/api/core/hooks.html"}},[e._v("hooks")]),e._v(" are executed on the "),s("code",[e._v("databases")]),e._v(" service:")],1),e._v(" "),s("Mermaid",{attrs:{id:"mermaid_382ee226",graph:e.$dataBlock.mermaid_382ee226}}),s("h2",{attrs:{id:"pusher-service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pusher-service"}},[e._v("#")]),e._v(" Pusher service")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("Available as a global service")])]),e._v(" "),s("p",[e._v("This service relies on "),s("a",{attrs:{href:"https://github.com/kalisio/sns-mobile",target:"_blank",rel:"noopener noreferrer"}},[e._v("sns-mobile"),s("OutboundLink")],1),e._v(", which has a "),s("a",{attrs:{href:"http://evanshortiss.com/development/mobile/2014/02/22/sns-push-notifications-using-nodejs.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("nice tutorial"),s("OutboundLink")],1),e._v(", to manage the link between "),s("a",{attrs:{href:"https://aws.amazon.com/sns",target:"_blank",rel:"noopener noreferrer"}},[e._v("AWS SNS"),s("OutboundLink")],1),e._v(" and internal resource objects in order to send push notifications to users.")]),e._v(" "),s("p",[e._v("To get an API access/secret key you need to create a new user in IAM with a role giving access to SNS like "),s("code",[e._v("AmazonSNSFullAccess")]),e._v(" but in production "),s("a",{attrs:{href:"http://docs.aws.amazon.com/sns/latest/dg/UsingIAMwithSNS.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("you should control access more precisely"),s("OutboundLink")],1),e._v(".")]),e._v(" "),s("p",[e._v("Since 2017 Google Cloud Messaging (GCM) has become Firebase Cloud Messaging (FCM), to generate an API key follow "),s("a",{attrs:{href:"https://stackoverflow.com/questions/39417797/amazon-sns-platform-credentials-are-invalid-when-re-entering-a-gcm-api-key-th",target:"_blank",rel:"noopener noreferrer"}},[e._v("this issue"),s("OutboundLink")],1),e._v(" and enter the server key when creating the SNS application on AWS. Although you use the Firebase console you should also see the created API through the Google Cloud console.")]),e._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),s("p",[s("code",[e._v("create")]),e._v(" and "),s("code",[e._v("remove")]),e._v(" methods are the only one allowed from the server side")])]),e._v(" "),s("h3",{attrs:{id:"data-model-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#data-model-3"}},[e._v("#")]),e._v(" Data model")]),e._v(" "),s("p",[e._v("This service helps (un)registering devices to/from SNS and create/remove SNS topics. This service also helps associating a "),s("em",[e._v("resource")]),e._v(" object (e.g. a group) with a SNS "),s("em",[e._v("topic")]),e._v(" to provide push notifications to the users associated with the resource. SNS ARNs are directly stored on the target resource(s) in the "),s("code",[e._v("topics")]),e._v(" property.")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("The service is designed to possibly manage a different topic per platform (e.g. ANDROID / IOS), although at the present time the same topic is used by all platforms because by default SNS topics are cross-platforms.")])]),e._v(" "),s("p",[e._v("For instance the topics associated to a group will result in the following structure on the group object:")]),e._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("_id")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("ObjectId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'5f568ba1fc54a1002fe6fe37'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'Centre de Castelnaudary'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("topics")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token constant"}},[e._v("ANDROID")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'arn:aws:sns:eu-west-1:xxx'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token constant"}},[e._v("IOS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'arn:aws:sns:eu-west-1:xxx'")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),s("p",[e._v("Last but not least, This service helps publishing messages to SNS devices or topics.")]),e._v(" "),s("p",[e._v("As a consequence, the "),s("code",[e._v("create")]),e._v("/"),s("code",[e._v("remove")]),e._v(" operations have to be called with an "),s("code",[e._v("action")]),e._v(" property indicating the target SNS operations among "),s("code",[e._v("device")]),e._v(", "),s("code",[e._v("topic")]),e._v(", "),s("code",[e._v("subscriptions")]),e._v(" and "),s("code",[e._v("message")]),e._v(". The payload varies according to the selected target operation:")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("device")]),e._v(":\n"),s("ul",[s("li",[s("strong",[e._v("device")]),e._v(" as data: device object with SNS ARN and/or registration ID (i.e. token) for APNS or Firebase")])])]),e._v(" "),s("li",[s("code",[e._v("topic")]),e._v(":\n"),s("ul",[s("li",[s("strong",[e._v("pushObject")]),e._v(" as params: target resource owing the topic")]),e._v(" "),s("li",[s("strong",[e._v("pushService")]),e._v(" as params: target resource service")]),e._v(" "),s("li",[s("strong",[e._v("topicField")]),e._v(" as data/query: target property to store the topic")])])]),e._v(" "),s("li",[s("code",[e._v("subscriptions")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("pushObject")]),e._v(" as params: target resource owing the topic")]),e._v(" "),s("li",[s("strong",[e._v("users")]),e._v(" as params: target subject(s) to subscribe to topic")]),e._v(" "),s("li",[s("strong",[e._v("topicField")]),e._v(" as data/query: target property to store the topic")])])]),e._v(" "),s("li",[s("code",[e._v("message")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("pushObject")]),e._v(" as params: target resource owing the topic if topic")]),e._v(" "),s("li",[s("strong",[e._v("pushService")]),e._v(" as params: target resource service")]),e._v(" "),s("li",[s("strong",[e._v("message")]),e._v(" as data: message payload")])])])]),e._v(" "),s("h3",{attrs:{id:"hooks-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hooks-4"}},[e._v("#")]),e._v(" Hooks")]),e._v(" "),s("p",[e._v("The following "),s("RouterLink",{attrs:{to:"/api/core/hooks.html"}},[e._v("hooks")]),e._v(" are executed on the "),s("code",[e._v("pusher")]),e._v(" service:")],1),e._v(" "),s("Mermaid",{attrs:{id:"mermaid_64a5691a",graph:e.$dataBlock.mermaid_64a5691a}}),s("h2",{attrs:{id:"account-service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#account-service"}},[e._v("#")]),e._v(" Account service")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("Available as a global service")])]),e._v(" "),s("p",[e._v("This service is powered by "),s("a",{attrs:{href:"https://github.com/feathersjs-ecosystem/feathers-authentication-management",target:"_blank",rel:"noopener noreferrer"}},[e._v("feathers-authentication-management"),s("OutboundLink")],1),e._v(".")]),e._v(" "),s("h3",{attrs:{id:"data-model-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#data-model-4"}},[e._v("#")]),e._v(" Data model")]),e._v(" "),s("p",[e._v("This service consists in associating verification tokens to users so that they can safely reset their password or change their email, please refer to "),s("a",{attrs:{href:"https://github.com/feathersjs-ecosystem/feathers-authentication-management",target:"_blank",rel:"noopener noreferrer"}},[e._v("feathers-authentication-management docs"),s("OutboundLink")],1),e._v(".")]),e._v(" "),s("h3",{attrs:{id:"hooks-5"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hooks-5"}},[e._v("#")]),e._v(" Hooks")]),e._v(" "),s("p",[e._v("The following "),s("RouterLink",{attrs:{to:"/api/core/hooks.html"}},[e._v("hooks")]),e._v(" are executed on the "),s("code",[e._v("account")]),e._v(" service:")],1),e._v(" "),s("Mermaid",{attrs:{id:"mermaid_64a5686c",graph:e.$dataBlock.mermaid_64a5686c}}),s("h3",{attrs:{id:"testing"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#testing"}},[e._v("#")]),e._v(" Testing")]),e._v(" "),s("p",[e._v("To make test run we need two gmail accounts:")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("email-notifications@kalisio.com")]),e._v(" used as email sender")]),e._v(" "),s("li",[s("code",[e._v("test@kalisio.com")]),e._v(" used as user test email")])]),e._v(" "),s("blockquote",[s("p",[e._v("When testing identity change we also use the "),s("code",[e._v("test@kalisio.xyz")]),e._v(" address as user test email. However to avoid creating a new account in Google you can simply add an alias for this address to the "),s("code",[e._v("test@kalisio.com")]),e._v(" account.")])]),e._v(" "),s("p",[e._v("The first email account is used by the "),s("RouterLink",{attrs:{to:"/api/core/services.html#mailer-service"}},[e._v("mailer service")]),e._v(" to send email notifications. The second email account requires OAuth2 authentication to be able to read emails using the GMail API. The simplest way is by creating a service account for a JWT-based authentication. Interesting issue to make all the configuration work can be found "),s("a",{attrs:{href:"https://stackoverflow.com/a/29328258",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),s("OutboundLink")],1),e._v(", notably you have to delegate domain-wide authority to the service account in order to authorize your app to access user data on behalf of users and authorise the client ID of the service account with scopes "),s("code",[e._v("https://mail.google.com/,https://www.googleapis.com/auth/gmail.readonly")]),e._v(".")],1),e._v(" "),s("p",[e._v("Standard OAuth2 with refresh token might also be used as detailed "),s("a",{attrs:{href:"https://medium.com/@pandeysoni/nodemailer-service-in-node-js-using-smtp-and-xoauth2-7c638a39a37e",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),s("OutboundLink")],1),e._v(" and "),s("a",{attrs:{href:"https://medium.com/@pandeysoni/nodemailer-service-in-node-js-using-smtp-and-xoauth2-7c638a39a37e",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),s("OutboundLink")],1),e._v(".")]),e._v(" "),s("p",[e._v("Details on how to use Google APIs from Node.js "),s("a",{attrs:{href:"https://github.com/google/google-api-nodejs-client#authorizing-and-authenticating",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),s("OutboundLink")],1),e._v(".")]),e._v(" "),s("blockquote",[s("p",[e._v('Some anti-virus or firewalls softwares intercept HTTPS traffic, decrypting it, and then encrypting it using a self-signed certificate causing a "'),s("em",[e._v("Self-Signed Certificate in Certificate Chain")]),e._v('" error. If so deactivate the SSL analysys in your software, '),s("a",{attrs:{href:"https://github.com/CawaMS/StorageExplorerTroubleshootingGuide/blob/master/se-troubleshooting-guide.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("this might help"),s("OutboundLink")],1),e._v(".")])]),e._v(" "),s("h2",{attrs:{id:"authorisations-service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#authorisations-service"}},[e._v("#")]),e._v(" Authorisations service")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("Available as a global service")])]),e._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),s("p",[s("code",[e._v("create")]),e._v(" and "),s("code",[e._v("remove")]),e._v(" methods are the only one allowed from the client/server side")])]),e._v(" "),s("h3",{attrs:{id:"data-model-5"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#data-model-5"}},[e._v("#")]),e._v(" Data model")]),e._v(" "),s("p",[e._v("An authorisation consists in associating a "),s("em",[e._v("resource")]),e._v(" object (e.g. a group) with a "),s("em",[e._v("subject")]),e._v(" object (e.g. a user) according to a "),s("em",[e._v("permission")]),e._v(" (i.e. a role or a right). The resource object information and the permission are directly stored on the target subject(s) in a property called the "),s("em",[e._v("scope")]),e._v(" of the authorisation (e.g. "),s("code",[e._v("groups")]),e._v(" to store all groups a user belongs to).")]),e._v(" "),s("p",[e._v("For instance the groups a user belongs to with different roles will result in the following structure on the user:")]),e._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("groups")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("_id")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("ObjectId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'5f568ba1fc54a1002fe6fe37'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'Centre de Castelnaudary'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("context")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'5f55f4169f6d47002f05f4ac'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("permissions")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'owner'")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("...")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("_id")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("ObjectId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'5f64a3791a1714002f68437d'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'Kalisio'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("context")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'5f532d439f6d47002f04f07e'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("permissions")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'manager'")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("...")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("_id")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("ObjectId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'5f65e34a75b663003095f52e'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'LTD'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("context")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'5f65d98084f9d5003039b55b'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("permissions")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'member'")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("...")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n")])])]),s("h3",{attrs:{id:"hooks-6"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hooks-6"}},[e._v("#")]),e._v(" Hooks")]),e._v(" "),s("p",[e._v("The following "),s("RouterLink",{attrs:{to:"/api/core/hooks.html"}},[e._v("hooks")]),e._v(" are executed on the "),s("code",[e._v("authorisations")]),e._v(" service:")],1),e._v(" "),s("Mermaid",{attrs:{id:"mermaid_64a561d4",graph:e.$dataBlock.mermaid_64a561d4}}),s("h2",{attrs:{id:"tags-service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tags-service"}},[e._v("#")]),e._v(" Tags service")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("Available as a global and a contextual service")])]),e._v(" "),s("p",[e._v('Tags can be created directly using this service or by "tagging" a target resource (e.g. a user). As a consequence, '),s("code",[e._v("create")]),e._v("/"),s("code",[e._v("remove")]),e._v(" operations can include a target resource as input data/ID.")]),e._v(" "),s("p",[e._v("Due to this behaviour tags are created/removed by value, not by ID. To avoid duplication when tagging multiple resources with the same tag, the service manages a reference count on tag objects and they are automatically created/removed accordingly.")]),e._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),s("p",[s("code",[e._v("remove")]),e._v(" method can be called with a resource ID")])]),e._v(" "),s("h3",{attrs:{id:"data-model-6"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#data-model-6"}},[e._v("#")]),e._v(" Data model")]),e._v(" "),s("p",[e._v("The data model of a tag as used by the API is "),s("RouterLink",{attrs:{to:"/architecture/data-model-view.html#tag-data-model"}},[e._v("detailed here")]),e._v(".")],1),e._v(" "),s("h3",{attrs:{id:"hooks-7"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hooks-7"}},[e._v("#")]),e._v(" Hooks")]),e._v(" "),s("p",[e._v("The following "),s("RouterLink",{attrs:{to:"/api/core/hooks.html"}},[e._v("hooks")]),e._v(" are executed on the "),s("code",[e._v("tags")]),e._v(" service:")],1),e._v(" "),s("Mermaid",{attrs:{id:"mermaid_64a560ec",graph:e.$dataBlock.mermaid_64a560ec}}),s("h2",{attrs:{id:"storage-service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#storage-service"}},[e._v("#")]),e._v(" Storage service")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("Available as a global and a contextual service")])]),e._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),s("p",[s("code",[e._v("get")]),e._v(", "),s("code",[e._v("create")]),e._v(" and "),s("code",[e._v("remove")]),e._v(" methods are the only one allowed from the client/server side")])]),e._v(" "),s("p",[e._v('Blobs can be created directly using this service or through "attachment" to a target resource (e.g. a user).')]),e._v(" "),s("p",[e._v("This service heavily relies on "),s("a",{attrs:{href:"https://github.com/feathersjs-ecosystem/feathers-blob",target:"_blank",rel:"noopener noreferrer"}},[e._v("feathers-blob"),s("OutboundLink")],1),e._v(" and "),s("a",{attrs:{href:"https://github.com/expressjs/multer",target:"_blank",rel:"noopener noreferrer"}},[e._v("multer"),s("OutboundLink")],1),e._v(" for handling "),s("a",{attrs:{href:"https://docs.feathersjs.com/guides/advanced/file-uploading.html#feathers-blob-with-multipart-support",target:"_blank",rel:"noopener noreferrer"}},[e._v("multipart/form-data"),s("OutboundLink")],1),e._v(".")]),e._v(" "),s("h3",{attrs:{id:"data-model-7"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#data-model-7"}},[e._v("#")]),e._v(" Data model")]),e._v(" "),s("p",[e._v("No data model, data are directly stored on target storage backend (i.e. AWS S3).")]),e._v(" "),s("h3",{attrs:{id:"hooks-8"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hooks-8"}},[e._v("#")]),e._v(" Hooks")]),e._v(" "),s("p",[e._v("The following "),s("RouterLink",{attrs:{to:"/api/core/hooks.html"}},[e._v("hooks")]),e._v(" are executed on the "),s("code",[e._v("storage")]),e._v(" service:")],1),e._v(" "),s("Mermaid",{attrs:{id:"mermaid_64a5602e",graph:e.$dataBlock.mermaid_64a5602e}}),s("h2",{attrs:{id:"databases-service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#databases-service"}},[e._v("#")]),e._v(" Databases service")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("Available as a global service")])]),e._v(" "),s("p",[e._v("This service is powered by "),s("a",{attrs:{href:"https://github.com/feathersjs-ecosystem/feathers-mongodb-management",target:"_blank",rel:"noopener noreferrer"}},[e._v("feathers-mongodb-management"),s("OutboundLink")],1),e._v(". It acts as a proxy to perform MongoDB operations like creating databases, collections or users.")]),e._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),s("p",[e._v("Service methods are only allowed from the server side")])]),e._v(" "),s("h3",{attrs:{id:"hooks-9"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hooks-9"}},[e._v("#")]),e._v(" Hooks")]),e._v(" "),s("p",[e._v("The following "),s("RouterLink",{attrs:{to:"/api/core/hooks.html"}},[e._v("hooks")]),e._v(" are executed on the "),s("code",[e._v("databases")]),e._v(" service:")],1),e._v(" "),s("Mermaid",{attrs:{id:"mermaid_64a55fac",graph:e.$dataBlock.mermaid_64a55fac}}),s("h2",{attrs:{id:"organisations-service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#organisations-service"}},[e._v("#")]),e._v(" Organisations service")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("Available as a global service")])]),e._v(" "),s("p",[e._v("This service exhibits the following methods in addition to standard CRUD operations:")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("createOrganisationServices")]),e._v(": creates all registered services for an organisation")]),e._v(" "),s("li",[s("strong",[e._v("removeOrganisationServices")]),e._v(": removes registered services for an organisation")]),e._v(" "),s("li",[s("strong",[e._v("registerOrganisationServicesHook(hook)")]),e._v(": register a function to create additional services per organisation")]),e._v(" "),s("li",[s("strong",[e._v("unregisterOrganisationServicesHook(hook)")]),e._v(": unregister a previously registered function")])]),e._v(" "),s("p",[e._v("A hook function has the following structure:")]),e._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[e._v("createOrganisationServices")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[e._v("organisation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" db")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[e._v("removeOrganisationServices")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[e._v("organisation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" db")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("By default the following services are created for an organisation: "),s("RouterLink",{attrs:{to:"/api/core/services.html#members-service"}},[e._v("members")]),e._v(", "),s("RouterLink",{attrs:{to:"/api/core/services.html#tags-service"}},[e._v("tags")]),e._v(", "),s("RouterLink",{attrs:{to:"/api/core/services.html#groups-service"}},[e._v("groups")]),e._v(", "),s("RouterLink",{attrs:{to:"/api/core/services.html#storage-service"}},[e._v("storage")]),e._v(".")],1)]),e._v(" "),s("h3",{attrs:{id:"data-model-8"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#data-model-8"}},[e._v("#")]),e._v(" Data model")]),e._v(" "),s("p",[e._v("The data model of an organisation as used by the API is "),s("RouterLink",{attrs:{to:"/architecture/data-model-view.html#organisation-data-model"}},[e._v("detailed here")]),e._v(".")],1),e._v(" "),s("h3",{attrs:{id:"hooks-10"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hooks-10"}},[e._v("#")]),e._v(" Hooks")]),e._v(" "),s("p",[e._v("No specific "),s("RouterLink",{attrs:{to:"/api/core/hooks.html"}},[e._v("hooks")]),e._v(" are executed on the "),s("code",[e._v("organisations")]),e._v(" service.")],1),e._v(" "),s("h2",{attrs:{id:"members-service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#members-service"}},[e._v("#")]),e._v(" Members service")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("Available as a contextual service")])]),e._v(" "),s("p",[e._v("This service is a proxy to the "),s("RouterLink",{attrs:{to:"/api/core/service.html#users-service"}},[e._v("users service")]),e._v(" available at the organisation level in order to filter users belonging to it.")],1),e._v(" "),s("h3",{attrs:{id:"data-model-9"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#data-model-9"}},[e._v("#")]),e._v(" Data model")]),e._v(" "),s("p",[e._v("The data model of a member as used by the API is a the one of a "),s("RouterLink",{attrs:{to:"/architecture/data-model-view.html#user-data-model"}},[e._v("user")]),e._v(".")],1),e._v(" "),s("h3",{attrs:{id:"hooks-11"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hooks-11"}},[e._v("#")]),e._v(" Hooks")]),e._v(" "),s("p",[e._v("No specific "),s("RouterLink",{attrs:{to:"/api/core/hooks.html"}},[e._v("hooks")]),e._v(" are executed on the "),s("code",[e._v("members")]),e._v(" service.")],1),e._v(" "),s("h2",{attrs:{id:"groups-service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#groups-service"}},[e._v("#")]),e._v(" Groups service")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("Available as a contextual service")])]),e._v(" "),s("h3",{attrs:{id:"data-model-10"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#data-model-10"}},[e._v("#")]),e._v(" Data model")]),e._v(" "),s("p",[e._v("The data model of a group as used by the API is "),s("RouterLink",{attrs:{to:"/architecture/data-model-view.html#group-data-model"}},[e._v("detailed here")]),e._v(".")],1),e._v(" "),s("h3",{attrs:{id:"hooks-12"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hooks-12"}},[e._v("#")]),e._v(" Hooks")]),e._v(" "),s("p",[e._v("The following "),s("RouterLink",{attrs:{to:"/api/core/hooks.html"}},[e._v("hooks")]),e._v(" are executed on the "),s("code",[e._v("groups")]),e._v(" service:")],1),e._v(" "),s("Mermaid",{attrs:{id:"mermaid_64a5582e",graph:e.$dataBlock.mermaid_64a5582e}}),s("h2",{attrs:{id:"local-settings-service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#local-settings-service"}},[e._v("#")]),e._v(" Local settings service")]),e._v(" "),s("p",[e._v("This "),s("strong",[e._v("client-side")]),e._v(" service allows to restore/save persistent settings to/from the "),s("RouterLink",{attrs:{to:"/api/core/application.html#store"}},[e._v("global store")]),e._v(" from/to "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage",target:"_blank",rel:"noopener noreferrer"}},[e._v("local storage"),s("OutboundLink")],1),e._v(".")],1),e._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),s("p",[s("code",[e._v("get")]),e._v(" and "),s("code",[e._v("patch")]),e._v(" methods are the only one allowed, "),s("code",[e._v("id")]),e._v(" parameter is ignored and methods will always target the whole settings object")])]),e._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),s("p",[e._v("This service has to be instanciated at application level, none provided by default")])]),e._v(" "),s("p",[e._v("To create your own service use the following code:")]),e._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" Store"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" LocalSettingsService "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'@kalisio/kdk/core.client'")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Setup defaults in global store")]),e._v("\nStore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'app-settings'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("x")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" y"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("...")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Create a service targeting only settings in store")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" settingsService "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("createService")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'settings'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("service")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" LocalSettingsService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("propertyMapping")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("x")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'app-settings.x'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("...")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Restore previous settings from local storage if any")]),e._v("\nsettingsService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("restoreSettings")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("Because settings are available through a service interface you can edit it using the "),s("RouterLink",{attrs:{to:"/api/core/components.html#editors"}},[e._v("editor system")]),e._v(". The "),s("code",[e._v("propertyMapping")]),e._v(" will be used to match form field names and corresponding global store properties.")],1)]),e._v(" "),s("p",[e._v("For instance the following schema can be used to edit the previous sample:")]),e._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"$schema"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"http://json-schema.org/draft-07/schema#"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"$id"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"http://www.kalisio.xyz/schemas/settings.update.json#"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"title"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"schemas.UPDATE_SETTINGS_TITLE"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"object"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"properties"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"x"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"string"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" \n      "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"field"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"component"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"form/KTextField"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"helper"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"schemas.X_FIELD_LABEL"')]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"required"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"x"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n")])])])],1)}),[],!1,null,null,null);"function"==typeof o&&o(r);t.default=r.exports}}]);