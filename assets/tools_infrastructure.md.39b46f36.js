import{_ as s,o as a,c as o,Q as n}from"./chunks/framework.70a39c86.js";const h=JSON.parse('{"title":"Infrastructure","description":"","frontmatter":{},"headers":[],"relativePath":"tools/infrastructure.md","filePath":"tools/infrastructure.md"}'),p={name:"tools/infrastructure.md"},l=n(`<h1 id="infrastructure" tabindex="-1">Infrastructure <a class="header-anchor" href="#infrastructure" aria-label="Permalink to &quot;Infrastructure&quot;">​</a></h1><h2 id="docker" tabindex="-1">Docker <a class="header-anchor" href="#docker" aria-label="Permalink to &quot;Docker&quot;">​</a></h2><p>Check why Docker service does not start:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">status</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docker.service</span></span>
<span class="line"><span style="color:#B392F0;">dockerd</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">status</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker.service</span></span>
<span class="line"><span style="color:#6F42C1;">dockerd</span></span></code></pre></div><p>Remove untaged/intermediate images generated by builds:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rmi</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">docker</span><span style="color:#9ECBFF;"> images </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">grep</span><span style="color:#9ECBFF;"> &quot;&lt;none&gt;&quot; </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">awk</span><span style="color:#9ECBFF;"> &#39;{print $3}&#39;)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rmi</span><span style="color:#24292E;"> </span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">docker</span><span style="color:#032F62;"> images </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">grep</span><span style="color:#032F62;"> &quot;&lt;none&gt;&quot; </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">awk</span><span style="color:#032F62;"> &#39;{print $3}&#39;)</span></span></code></pre></div><p>Follow-up logs while running a container:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">logs</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">container_name</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--tail</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">100</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">logs</span><span style="color:#24292E;"> </span><span style="color:#032F62;">container_name</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--tail</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">100</span></span></code></pre></div><p>Get detailed healthcheck status for a running container:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">inspect</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;{{json .State.Health.Status}}&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">container_name</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">inspect</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;{{json .State.Health.Status}}&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">container_name</span></span></code></pre></div><p>Find the location of the log file of a container:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">inspect</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--format=</span><span style="color:#9ECBFF;">&#39;{{.LogPath}}&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">container_name</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">inspect</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--format=</span><span style="color:#032F62;">&#39;{{.LogPath}}&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">container_name</span></span></code></pre></div><p>Find the location of a named volume of a container:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">volume</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">inspect</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">volume_name</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">volume</span><span style="color:#24292E;"> </span><span style="color:#032F62;">inspect</span><span style="color:#24292E;"> </span><span style="color:#032F62;">volume_name</span></span></code></pre></div><p>Export the logs with errors in a file:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">logs</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">aktnmap</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">aktnmap.log</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">2&gt;&amp;1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">logs</span><span style="color:#24292E;"> </span><span style="color:#032F62;">aktnmap</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">aktnmap.log</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">2&gt;&amp;1</span></span></code></pre></div><p>Quick container fix:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">//</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Perform</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">configuration</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">changes</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">inside</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">container</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">then</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">exit</span></span>
<span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">exec</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-it</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">container_name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bash</span></span>
<span class="line"><span style="color:#B392F0;">//</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Or</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">copy</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">configuration</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">files</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">host</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">then</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">back</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">container</span></span>
<span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cp</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">container_name:/conf/config_file</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">.</span></span>
<span class="line"><span style="color:#B392F0;">//</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Edit</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">config</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">file</span></span>
<span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cp</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">config_file</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">container_name:/conf</span></span>
<span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">commit</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">container_name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">repository:tag</span></span>
<span class="line"><span style="color:#B392F0;">docker-compose</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">down</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">...</span></span>
<span class="line"><span style="color:#B392F0;">docker-compose</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">up</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">...</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">//</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Perform</span><span style="color:#24292E;"> </span><span style="color:#032F62;">configuration</span><span style="color:#24292E;"> </span><span style="color:#032F62;">changes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">inside</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">container</span><span style="color:#24292E;"> </span><span style="color:#032F62;">then</span><span style="color:#24292E;"> </span><span style="color:#032F62;">exit</span></span>
<span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">exec</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-it</span><span style="color:#24292E;"> </span><span style="color:#032F62;">container_name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bash</span></span>
<span class="line"><span style="color:#6F42C1;">//</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Or</span><span style="color:#24292E;"> </span><span style="color:#032F62;">copy</span><span style="color:#24292E;"> </span><span style="color:#032F62;">configuration</span><span style="color:#24292E;"> </span><span style="color:#032F62;">files</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">host</span><span style="color:#24292E;"> </span><span style="color:#032F62;">then</span><span style="color:#24292E;"> </span><span style="color:#032F62;">back</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">container</span></span>
<span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cp</span><span style="color:#24292E;"> </span><span style="color:#032F62;">container_name:/conf/config_file</span><span style="color:#24292E;"> </span><span style="color:#032F62;">.</span></span>
<span class="line"><span style="color:#6F42C1;">//</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Edit</span><span style="color:#24292E;"> </span><span style="color:#032F62;">config</span><span style="color:#24292E;"> </span><span style="color:#032F62;">file</span></span>
<span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cp</span><span style="color:#24292E;"> </span><span style="color:#032F62;">config_file</span><span style="color:#24292E;"> </span><span style="color:#032F62;">container_name:/conf</span></span>
<span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">commit</span><span style="color:#24292E;"> </span><span style="color:#032F62;">container_name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">repository:tag</span></span>
<span class="line"><span style="color:#6F42C1;">docker-compose</span><span style="color:#24292E;"> </span><span style="color:#032F62;">down</span><span style="color:#24292E;"> </span><span style="color:#032F62;">...</span></span>
<span class="line"><span style="color:#6F42C1;">docker-compose</span><span style="color:#24292E;"> </span><span style="color:#032F62;">up</span><span style="color:#24292E;"> </span><span style="color:#032F62;">...</span></span></code></pre></div><p>Check why a swarm service did not start (empty logs, no replica):</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">service</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ps</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--no-trunc</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{serviceName}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">service</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ps</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--no-trunc</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{serviceName}</span></span></code></pre></div><p>To access host in Docker Desktop Edition on <a href="https://docs.docker.com/docker-for-windows/networking/" target="_blank" rel="noreferrer">Windows</a> or <a href="https://docs.docker.com/docker-for-mac/networking/" target="_blank" rel="noreferrer">Mac</a> use the special DNS name <code>host.docker.internal</code>.</p><h2 id="traefik" tabindex="-1">Traefik <a class="header-anchor" href="#traefik" aria-label="Permalink to &quot;Traefik&quot;">​</a></h2><p>Extract access logs for a given date time: <code>cat access.log | grep &quot;10/Mar/2020:02&quot; &gt; access-10-03-2020-03.log</code> Check access logs for a given HTTP error code: <code>cat access.log | grep &quot;1.0\\&quot; 404&quot;</code> or <code>cat access.log | grep &quot;2.0\\&quot; 404&quot;</code> Gzip access logs: <code>gzip -c access.log &gt; access.log.gz</code></p><h2 id="scaleway" tabindex="-1">Scaleway <a class="header-anchor" href="#scaleway" aria-label="Permalink to &quot;Scaleway&quot;">​</a></h2><p>A <a href="https://gist.github.com/cnouguier/a1ecc88f67819a610ae8e4d221789a8c" target="_blank" rel="noreferrer">step-by-step configuration</a> of a new server with Docker and a single logical volume.</p><h2 id="networking" tabindex="-1">Networking <a class="header-anchor" href="#networking" aria-label="Permalink to &quot;Networking&quot;">​</a></h2><p>List all running ssh sessions: <code>netstat -tnpa | grep &#39;ESTABLISHED.*sshd&#39;</code></p><p>List all ssh session attempts: <code>cat /var/log/auth.log</code></p><h3 id="development-domains" tabindex="-1">Development domains <a class="header-anchor" href="#development-domains" aria-label="Permalink to &quot;Development domains&quot;">​</a></h3><p>Some development tasks like OAuth2 authentication have strict security concerns so that you cannot use <code>localhost</code>, non-standard ports or need to enforce HTTPS in all URLs. Here is how to setup a &quot;fake&quot; domain on your host.</p><p>Let&#39;s say we have our app running on <code>localhost:8080</code> in HTTP or <code>localhost:8083</code> in HTTPS. First, edit the <code>hosts</code> file (<em>/etc/hosts</em> under Linux or <em>C:\\Windows\\System32\\drivers\\etc\\hosts</em> under Windows) and add this line to redirect the domain to local host:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">127.0.0.1 test.airbusoidc.com</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">127.0.0.1 test.airbusoidc.com</span></span></code></pre></div><p>Then, since the <code>hosts</code> file does not allow to manage port redirections we need to do so using the operating system network tools.</p><h4 id="windows" tabindex="-1">Windows <a class="header-anchor" href="#windows" aria-label="Permalink to &quot;Windows&quot;">​</a></h4><p>To see what is currently running:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">netstat</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-a</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TCP</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">grep</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;LISTENING&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">netstat</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-a</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TCP</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">grep</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;LISTENING&quot;</span></span></code></pre></div><p>To add port redirection for HTTP:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">netsh</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">interface</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">portproxy</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">add</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">v4tov4</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">listenport=</span><span style="color:#79B8FF;">80</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">listenaddress=</span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">connectport=</span><span style="color:#79B8FF;">8080</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">connectaddress=</span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">netsh</span><span style="color:#24292E;"> </span><span style="color:#032F62;">interface</span><span style="color:#24292E;"> </span><span style="color:#032F62;">portproxy</span><span style="color:#24292E;"> </span><span style="color:#032F62;">add</span><span style="color:#24292E;"> </span><span style="color:#032F62;">v4tov4</span><span style="color:#24292E;"> </span><span style="color:#032F62;">listenport=</span><span style="color:#005CC5;">80</span><span style="color:#24292E;"> </span><span style="color:#032F62;">listenaddress=</span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">connectport=</span><span style="color:#005CC5;">8080</span><span style="color:#24292E;"> </span><span style="color:#032F62;">connectaddress=</span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1</span></span></code></pre></div><p>To add port redirection for HTTPS:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">netsh</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">interface</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">portproxy</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">add</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">v4tov4</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">listenport=</span><span style="color:#79B8FF;">443</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">listenaddress=</span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">connectport=</span><span style="color:#79B8FF;">8083</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">connectaddress=</span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">netsh</span><span style="color:#24292E;"> </span><span style="color:#032F62;">interface</span><span style="color:#24292E;"> </span><span style="color:#032F62;">portproxy</span><span style="color:#24292E;"> </span><span style="color:#032F62;">add</span><span style="color:#24292E;"> </span><span style="color:#032F62;">v4tov4</span><span style="color:#24292E;"> </span><span style="color:#032F62;">listenport=</span><span style="color:#005CC5;">443</span><span style="color:#24292E;"> </span><span style="color:#032F62;">listenaddress=</span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">connectport=</span><span style="color:#005CC5;">8083</span><span style="color:#24292E;"> </span><span style="color:#032F62;">connectaddress=</span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1</span></span></code></pre></div><p>To see running proxied port:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">netsh</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">interface</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">portproxy</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">show</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">v4tov4</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">netsh</span><span style="color:#24292E;"> </span><span style="color:#032F62;">interface</span><span style="color:#24292E;"> </span><span style="color:#032F62;">portproxy</span><span style="color:#24292E;"> </span><span style="color:#032F62;">show</span><span style="color:#24292E;"> </span><span style="color:#032F62;">v4tov4</span></span></code></pre></div><p>To see remove proxied port:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">netsh</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">interface</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">portproxy</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">delete</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">v4tov4</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">listenport=</span><span style="color:#79B8FF;">80</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">listenaddress=</span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">netsh</span><span style="color:#24292E;"> </span><span style="color:#032F62;">interface</span><span style="color:#24292E;"> </span><span style="color:#032F62;">portproxy</span><span style="color:#24292E;"> </span><span style="color:#032F62;">delete</span><span style="color:#24292E;"> </span><span style="color:#032F62;">v4tov4</span><span style="color:#24292E;"> </span><span style="color:#032F62;">listenport=</span><span style="color:#005CC5;">80</span><span style="color:#24292E;"> </span><span style="color:#032F62;">listenaddress=</span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1</span></span></code></pre></div><h4 id="linux" tabindex="-1">Linux <a class="header-anchor" href="#linux" aria-label="Permalink to &quot;Linux&quot;">​</a></h4><p>First enable port redirection:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;1&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/proc/sys/net/ipv4/ip_forward</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;1&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/proc/sys/net/ipv4/ip_forward</span></span></code></pre></div><p>Then add port redirect:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">iptables</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-t</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nat</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-A</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">PREROUTING</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-s</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tcp</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--dport</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">80</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-j</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">REDIRECT</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--to</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">8080</span><span style="color:#9ECBFF;">\`</span></span>
<span class="line"><span style="color:#B392F0;">iptables</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-t</span><span style="color:#9ECBFF;"> nat </span><span style="color:#79B8FF;">-A</span><span style="color:#9ECBFF;"> OUTPUT </span><span style="color:#79B8FF;">-s</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1 </span><span style="color:#79B8FF;">-p</span><span style="color:#9ECBFF;"> tcp </span><span style="color:#79B8FF;">--dport</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">80</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-j</span><span style="color:#9ECBFF;"> REDIRECT </span><span style="color:#79B8FF;">--to</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">8080</span><span style="color:#9ECBFF;">\`</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">iptables</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-t</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nat</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-A</span><span style="color:#24292E;"> </span><span style="color:#032F62;">PREROUTING</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-s</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tcp</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--dport</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">80</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-j</span><span style="color:#24292E;"> </span><span style="color:#032F62;">REDIRECT</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--to</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">8080</span><span style="color:#032F62;">\`</span></span>
<span class="line"><span style="color:#6F42C1;">iptables</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-t</span><span style="color:#032F62;"> nat </span><span style="color:#005CC5;">-A</span><span style="color:#032F62;"> OUTPUT </span><span style="color:#005CC5;">-s</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1 </span><span style="color:#005CC5;">-p</span><span style="color:#032F62;"> tcp </span><span style="color:#005CC5;">--dport</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">80</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-j</span><span style="color:#032F62;"> REDIRECT </span><span style="color:#005CC5;">--to</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">8080</span><span style="color:#032F62;">\`</span></span></code></pre></div><p>To remove simply replace in the previous command the <code>-D</code> switch instead of the <code>-A</code> switch.</p>`,50),e=[l];function t(c,r,y,E,i,F){return a(),o("div",null,e)}const C=s(p,[["render",t]]);export{h as __pageData,C as default};
